{"ast":null,"code":"/**\r\n * DevExtreme (ui/selection/selection.strategy.standard.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _array_compare = require(\"../../core/utils/array_compare\");\n\nvar _query = _interopRequireDefault(require(\"../../data/query\"));\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _selection_filter = require(\"../../core/utils/selection_filter\");\n\nvar _ui = _interopRequireDefault(require(\"../widget/ui.errors\"));\n\nvar _selection = _interopRequireDefault(require(\"./selection.strategy\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar _default = _selection.default.inherit({\n  ctor: function (options) {\n    this.callBase(options);\n\n    this._initSelectedItemKeyHash();\n  },\n  _initSelectedItemKeyHash: function () {\n    this._setOption(\"keyHashIndices\", this.options.equalByReference ? null : {});\n  },\n  getSelectedItemKeys: function () {\n    return this.options.selectedItemKeys.slice(0);\n  },\n  getSelectedItems: function () {\n    return this.options.selectedItems.slice(0);\n  },\n  _preserveSelectionUpdate: function (items, isDeselect) {\n    var keyOf = this.options.keyOf;\n    var keyIndicesToRemoveMap;\n    var keyIndex;\n    var i;\n\n    if (!keyOf) {\n      return;\n    }\n\n    var isBatchDeselect = isDeselect && items.length > 1 && !this.options.equalByReference;\n\n    if (isBatchDeselect) {\n      keyIndicesToRemoveMap = {};\n    }\n\n    for (i = 0; i < items.length; i++) {\n      var item = items[i];\n      var key = keyOf(item);\n\n      if (isDeselect) {\n        keyIndex = this.removeSelectedItem(key, keyIndicesToRemoveMap);\n\n        if (keyIndicesToRemoveMap && keyIndex >= 0) {\n          keyIndicesToRemoveMap[keyIndex] = true;\n        }\n      } else {\n        this.addSelectedItem(key, item);\n      }\n    }\n\n    if (isBatchDeselect) {\n      this._batchRemoveSelectedItems(keyIndicesToRemoveMap);\n    }\n  },\n  _batchRemoveSelectedItems: function (keyIndicesToRemoveMap) {\n    var selectedItemKeys = this.options.selectedItemKeys.slice(0);\n    var selectedItems = this.options.selectedItems.slice(0);\n    this.options.selectedItemKeys.length = 0;\n    this.options.selectedItems.length = 0;\n\n    for (var i = 0; i < selectedItemKeys.length; i++) {\n      if (!keyIndicesToRemoveMap[i]) {\n        this.options.selectedItemKeys.push(selectedItemKeys[i]);\n        this.options.selectedItems.push(selectedItems[i]);\n      }\n    }\n\n    this._initSelectedItemKeyHash();\n\n    this.updateSelectedItemKeyHash(this.options.selectedItemKeys);\n  },\n  _loadSelectedItemsCore: function (keys, isDeselect, isSelectAll) {\n    var deferred = new _deferred.Deferred();\n    var key = this.options.key();\n\n    if (!keys.length && !isSelectAll) {\n      deferred.resolve([]);\n      return deferred;\n    }\n\n    var filter = this.options.filter();\n\n    if (isSelectAll && isDeselect && !filter) {\n      deferred.resolve(this.getSelectedItems());\n      return deferred;\n    }\n\n    var selectionFilterCreator = new _selection_filter.SelectionFilterCreator(keys, isSelectAll);\n    var combinedFilter = selectionFilterCreator.getCombinedFilter(key, filter);\n    var deselectedItems = [];\n\n    if (isDeselect) {\n      deselectedItems = combinedFilter ? (0, _query.default)(this.options.selectedItems).filter(combinedFilter).toArray() : this.options.selectedItems.slice(0);\n    }\n\n    var filteredItems = deselectedItems.length ? deselectedItems : this.options.plainItems(true).filter(this.options.isSelectableItem).map(this.options.getItemData);\n    var localFilter = selectionFilterCreator.getLocalFilter(this.options.keyOf, this.equalKeys.bind(this), this.options.equalByReference, key);\n    filteredItems = filteredItems.filter(localFilter);\n\n    if (deselectedItems.length || !isSelectAll && filteredItems.length === keys.length) {\n      deferred.resolve(filteredItems);\n    } else {\n      deferred = this._loadFilteredData(combinedFilter, localFilter, null, isSelectAll);\n    }\n\n    return deferred;\n  },\n  _replaceSelectionUpdate: function (items) {\n    var internalKeys = [];\n    var keyOf = this.options.keyOf;\n\n    if (!keyOf) {\n      return;\n    }\n\n    for (var i = 0; i < items.length; i++) {\n      var item = items[i];\n      var key = keyOf(item);\n      internalKeys.push(key);\n    }\n\n    this.setSelectedItems(internalKeys, items);\n  },\n  _warnOnIncorrectKeys: function (keys) {\n    var allowNullValue = this.options.allowNullValue;\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n\n      if ((!allowNullValue || null !== key) && !this.isItemKeySelected(key)) {\n        _ui.default.log(\"W1002\", key);\n      }\n    }\n  },\n  _isMultiSelectEnabled: function () {\n    var mode = this.options.mode;\n    return \"all\" === mode || \"multiple\" === mode;\n  },\n  _requestInProgress: function () {\n    var _this$_lastLoadDeferr;\n\n    return \"pending\" === (null === (_this$_lastLoadDeferr = this._lastLoadDeferred) || void 0 === _this$_lastLoadDeferr ? void 0 : _this$_lastLoadDeferr.state());\n  },\n  _concatRequestsItems: function (keys, isDeselect, oldRequestItems) {\n    var deselectedItems = isDeselect ? keys : [];\n    return {\n      addedItems: oldRequestItems.added.concat((0, _array.removeDuplicates)(keys, this.options.selectedItemKeys)),\n      removedItems: oldRequestItems.removed.concat(deselectedItems),\n      keys: keys\n    };\n  },\n  _collectLastRequestData: function (keys, isDeselect, isSelectAll) {\n    var isDeselectAll = isDeselect && isSelectAll;\n    var oldRequestItems = {\n      added: [],\n      removed: []\n    };\n\n    var multiSelectEnabled = this._isMultiSelectEnabled();\n\n    var lastRequestData = multiSelectEnabled ? this._lastRequestData : {};\n\n    if (multiSelectEnabled) {\n      if (this._requestInProgress()) {\n        if (isDeselectAll) {\n          this._lastLoadDeferred.reject();\n\n          lastRequestData = {};\n        } else {\n          if (!(0, _array_compare.isKeysEqual)(keys, this.options.selectedItemKeys)) {\n            oldRequestItems.added = lastRequestData.addedItems;\n            oldRequestItems.removed = lastRequestData.removedItems;\n\n            if (!isDeselect) {\n              this._lastLoadDeferred.reject();\n            }\n          } else {\n            lastRequestData = {};\n          }\n        }\n      }\n\n      lastRequestData = this._concatRequestsItems(keys, isDeselect, oldRequestItems);\n    }\n\n    return lastRequestData;\n  },\n  _updateKeysByLastRequestData: function (keys, isDeselect, isSelectAll) {\n    var currentKeys = keys;\n\n    if (this._isMultiSelectEnabled() && !isDeselect && !isSelectAll) {\n      var _this$_lastRequestDat, _this$_lastRequestDat2;\n\n      currentKeys = (0, _array.removeDuplicates)(keys.concat(null === (_this$_lastRequestDat = this._lastRequestData) || void 0 === _this$_lastRequestDat ? void 0 : _this$_lastRequestDat.addedItems), null === (_this$_lastRequestDat2 = this._lastRequestData) || void 0 === _this$_lastRequestDat2 ? void 0 : _this$_lastRequestDat2.removedItems);\n      currentKeys = (0, _array.uniqueValues)(currentKeys);\n    }\n\n    return currentKeys;\n  },\n  _loadSelectedItems: function (keys, isDeselect, isSelectAll) {\n    var that = this;\n    var deferred = new _deferred.Deferred();\n    this._lastRequestData = this._collectLastRequestData(keys, isDeselect, isSelectAll);\n    (0, _deferred.when)(that._lastLoadDeferred).always(function () {\n      var currentKeys = that._updateKeysByLastRequestData(keys, isDeselect, isSelectAll);\n\n      that._loadSelectedItemsCore(currentKeys, isDeselect, isSelectAll).done(deferred.resolve).fail(deferred.reject);\n    });\n    that._lastLoadDeferred = deferred;\n    return deferred;\n  },\n  selectedItemKeys: function (keys, preserve, isDeselect, isSelectAll) {\n    var that = this;\n\n    var deferred = that._loadSelectedItems(keys, isDeselect, isSelectAll);\n\n    deferred.done(function (items) {\n      if (preserve) {\n        that._preserveSelectionUpdate(items, isDeselect);\n      } else {\n        that._replaceSelectionUpdate(items);\n      }\n\n      that.onSelectionChanged();\n    });\n    return deferred;\n  },\n  addSelectedItem: function (key, itemData) {\n    if ((0, _type.isDefined)(itemData) && itemData.disabled) {\n      if (this.options.disabledItemKeys.indexOf(key) === -1) {\n        this.options.disabledItemKeys.push(key);\n      }\n\n      return;\n    }\n\n    var keyHash = this._getKeyHash(key);\n\n    if (this._indexOfSelectedItemKey(keyHash) === -1) {\n      if (!(0, _type.isObject)(keyHash) && this.options.keyHashIndices) {\n        this.options.keyHashIndices[keyHash] = [this.options.selectedItemKeys.length];\n      }\n\n      this.options.selectedItemKeys.push(key);\n      this.options.addedItemKeys.push(key);\n      this.options.addedItems.push(itemData);\n      this.options.selectedItems.push(itemData);\n    }\n  },\n  _getSelectedIndexByKey: function (key, ignoreIndicesMap) {\n    var selectedItemKeys = this.options.selectedItemKeys;\n\n    for (var index = 0; index < selectedItemKeys.length; index++) {\n      if ((!ignoreIndicesMap || !ignoreIndicesMap[index]) && this.equalKeys(selectedItemKeys[index], key)) {\n        return index;\n      }\n    }\n\n    return -1;\n  },\n  _getSelectedIndexByHash: function (key, ignoreIndicesMap) {\n    var indices = this.options.keyHashIndices[key];\n\n    if (indices && indices.length > 1 && ignoreIndicesMap) {\n      indices = indices.filter(function (index) {\n        return !ignoreIndicesMap[index];\n      });\n    }\n\n    return indices && indices[0] >= 0 ? indices[0] : -1;\n  },\n  _indexOfSelectedItemKey: function (key, ignoreIndicesMap) {\n    var selectedIndex;\n\n    if (this.options.equalByReference) {\n      selectedIndex = this.options.selectedItemKeys.indexOf(key);\n    } else {\n      if ((0, _type.isObject)(key)) {\n        selectedIndex = this._getSelectedIndexByKey(key, ignoreIndicesMap);\n      } else {\n        selectedIndex = this._getSelectedIndexByHash(key, ignoreIndicesMap);\n      }\n    }\n\n    return selectedIndex;\n  },\n  _shiftSelectedKeyIndices: function (keyIndex) {\n    for (var currentKeyIndex = keyIndex; currentKeyIndex < this.options.selectedItemKeys.length; currentKeyIndex++) {\n      var currentKey = this.options.selectedItemKeys[currentKeyIndex];\n      var currentKeyHash = (0, _common.getKeyHash)(currentKey);\n      var currentKeyIndices = this.options.keyHashIndices[currentKeyHash];\n\n      if (!currentKeyIndices) {\n        continue;\n      }\n\n      for (var i = 0; i < currentKeyIndices.length; i++) {\n        if (currentKeyIndices[i] > keyIndex) {\n          currentKeyIndices[i]--;\n        }\n      }\n    }\n  },\n  removeSelectedItem: function (key, keyIndicesToRemoveMap) {\n    var keyHash = this._getKeyHash(key);\n\n    var isBatchDeselect = !!keyIndicesToRemoveMap;\n\n    var keyIndex = this._indexOfSelectedItemKey(keyHash, keyIndicesToRemoveMap);\n\n    if (keyIndex < 0) {\n      return keyIndex;\n    }\n\n    this.options.removedItemKeys.push(key);\n    this.options.removedItems.push(this.options.selectedItems[keyIndex]);\n\n    if (isBatchDeselect) {\n      return keyIndex;\n    }\n\n    this.options.selectedItemKeys.splice(keyIndex, 1);\n    this.options.selectedItems.splice(keyIndex, 1);\n\n    if ((0, _type.isObject)(keyHash) || !this.options.keyHashIndices) {\n      return keyIndex;\n    }\n\n    var keyIndices = this.options.keyHashIndices[keyHash];\n\n    if (!keyIndices) {\n      return keyIndex;\n    }\n\n    keyIndices.shift();\n\n    if (!keyIndices.length) {\n      delete this.options.keyHashIndices[keyHash];\n    }\n\n    this._shiftSelectedKeyIndices(keyIndex);\n\n    return keyIndex;\n  },\n  _updateAddedItemKeys: function (keys, items) {\n    for (var i = 0; i < keys.length; i++) {\n      if (!this.isItemKeySelected(keys[i])) {\n        this.options.addedItemKeys.push(keys[i]);\n        this.options.addedItems.push(items[i]);\n      }\n    }\n  },\n  _updateRemovedItemKeys: function (keys, oldSelectedKeys, oldSelectedItems) {\n    for (var i = 0; i < oldSelectedKeys.length; i++) {\n      if (!this.isItemKeySelected(oldSelectedKeys[i])) {\n        this.options.removedItemKeys.push(oldSelectedKeys[i]);\n        this.options.removedItems.push(oldSelectedItems[i]);\n      }\n    }\n  },\n  _isItemSelectionInProgress: function (key, checkPending) {\n    var shouldCheckPending = checkPending && this._lastRequestData && this._requestInProgress();\n\n    if (shouldCheckPending) {\n      return this._lastRequestData.addedItems && this._lastRequestData.addedItems.indexOf(key) !== -1;\n    } else {\n      return false;\n    }\n  },\n  _getKeyHash: function (key) {\n    return this.options.equalByReference ? key : (0, _common.getKeyHash)(key);\n  },\n  setSelectedItems: function (keys, items) {\n    this._updateAddedItemKeys(keys, items);\n\n    var oldSelectedKeys = this.options.selectedItemKeys;\n    var oldSelectedItems = this.options.selectedItems;\n\n    if (!this.options.equalByReference) {\n      this._initSelectedItemKeyHash();\n\n      this.updateSelectedItemKeyHash(keys);\n    }\n\n    this._setOption(\"selectedItemKeys\", keys);\n\n    this._setOption(\"selectedItems\", items);\n\n    this._updateRemovedItemKeys(keys, oldSelectedKeys, oldSelectedItems);\n  },\n  isItemDataSelected: function (itemData) {\n    var options = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\n    var key = this.options.keyOf(itemData);\n    return this.isItemKeySelected(key, options);\n  },\n  isItemKeySelected: function (key) {\n    var options = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\n\n    var result = this._isItemSelectionInProgress(key, options.checkPending);\n\n    if (!result) {\n      var keyHash = this._getKeyHash(key);\n\n      var index = this._indexOfSelectedItemKey(keyHash);\n\n      result = index !== -1;\n    }\n\n    return result;\n  },\n  getSelectAllState: function (visibleOnly) {\n    if (visibleOnly) {\n      return this._getVisibleSelectAllState();\n    } else {\n      return this._getFullSelectAllState();\n    }\n  }\n});\n\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["/home/emma/node_modules/devextreme/ui/selection/selection.strategy.standard.js"],"names":["exports","default","_common","require","_type","_array","_array_compare","_query","_interopRequireDefault","_deferred","_selection_filter","_ui","_selection","obj","__esModule","_default","inherit","ctor","options","callBase","_initSelectedItemKeyHash","_setOption","equalByReference","getSelectedItemKeys","selectedItemKeys","slice","getSelectedItems","selectedItems","_preserveSelectionUpdate","items","isDeselect","keyOf","keyIndicesToRemoveMap","keyIndex","i","isBatchDeselect","length","item","key","removeSelectedItem","addSelectedItem","_batchRemoveSelectedItems","push","updateSelectedItemKeyHash","_loadSelectedItemsCore","keys","isSelectAll","deferred","Deferred","resolve","filter","selectionFilterCreator","SelectionFilterCreator","combinedFilter","getCombinedFilter","deselectedItems","toArray","filteredItems","plainItems","isSelectableItem","map","getItemData","localFilter","getLocalFilter","equalKeys","bind","_loadFilteredData","_replaceSelectionUpdate","internalKeys","setSelectedItems","_warnOnIncorrectKeys","allowNullValue","isItemKeySelected","log","_isMultiSelectEnabled","mode","_requestInProgress","_this$_lastLoadDeferr","_lastLoadDeferred","state","_concatRequestsItems","oldRequestItems","addedItems","added","concat","removeDuplicates","removedItems","removed","_collectLastRequestData","isDeselectAll","multiSelectEnabled","lastRequestData","_lastRequestData","reject","isKeysEqual","_updateKeysByLastRequestData","currentKeys","_this$_lastRequestDat","_this$_lastRequestDat2","uniqueValues","_loadSelectedItems","that","when","always","done","fail","preserve","onSelectionChanged","itemData","isDefined","disabled","disabledItemKeys","indexOf","keyHash","_getKeyHash","_indexOfSelectedItemKey","isObject","keyHashIndices","addedItemKeys","_getSelectedIndexByKey","ignoreIndicesMap","index","_getSelectedIndexByHash","indices","selectedIndex","_shiftSelectedKeyIndices","currentKeyIndex","currentKey","currentKeyHash","getKeyHash","currentKeyIndices","removedItemKeys","splice","keyIndices","shift","_updateAddedItemKeys","_updateRemovedItemKeys","oldSelectedKeys","oldSelectedItems","_isItemSelectionInProgress","checkPending","shouldCheckPending","isItemDataSelected","arguments","result","getSelectAllState","visibleOnly","_getVisibleSelectAllState","_getFullSelectAllState","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/selection/selection.strategy.standard.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _array_compare = require(\"../../core/utils/array_compare\");\r\nvar _query = _interopRequireDefault(require(\"../../data/query\"));\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _selection_filter = require(\"../../core/utils/selection_filter\");\r\nvar _ui = _interopRequireDefault(require(\"../widget/ui.errors\"));\r\nvar _selection = _interopRequireDefault(require(\"./selection.strategy\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar _default = _selection.default.inherit({\r\n    ctor: function(options) {\r\n        this.callBase(options);\r\n        this._initSelectedItemKeyHash()\r\n    },\r\n    _initSelectedItemKeyHash: function() {\r\n        this._setOption(\"keyHashIndices\", this.options.equalByReference ? null : {})\r\n    },\r\n    getSelectedItemKeys: function() {\r\n        return this.options.selectedItemKeys.slice(0)\r\n    },\r\n    getSelectedItems: function() {\r\n        return this.options.selectedItems.slice(0)\r\n    },\r\n    _preserveSelectionUpdate: function(items, isDeselect) {\r\n        var keyOf = this.options.keyOf;\r\n        var keyIndicesToRemoveMap;\r\n        var keyIndex;\r\n        var i;\r\n        if (!keyOf) {\r\n            return\r\n        }\r\n        var isBatchDeselect = isDeselect && items.length > 1 && !this.options.equalByReference;\r\n        if (isBatchDeselect) {\r\n            keyIndicesToRemoveMap = {}\r\n        }\r\n        for (i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            var key = keyOf(item);\r\n            if (isDeselect) {\r\n                keyIndex = this.removeSelectedItem(key, keyIndicesToRemoveMap);\r\n                if (keyIndicesToRemoveMap && keyIndex >= 0) {\r\n                    keyIndicesToRemoveMap[keyIndex] = true\r\n                }\r\n            } else {\r\n                this.addSelectedItem(key, item)\r\n            }\r\n        }\r\n        if (isBatchDeselect) {\r\n            this._batchRemoveSelectedItems(keyIndicesToRemoveMap)\r\n        }\r\n    },\r\n    _batchRemoveSelectedItems: function(keyIndicesToRemoveMap) {\r\n        var selectedItemKeys = this.options.selectedItemKeys.slice(0);\r\n        var selectedItems = this.options.selectedItems.slice(0);\r\n        this.options.selectedItemKeys.length = 0;\r\n        this.options.selectedItems.length = 0;\r\n        for (var i = 0; i < selectedItemKeys.length; i++) {\r\n            if (!keyIndicesToRemoveMap[i]) {\r\n                this.options.selectedItemKeys.push(selectedItemKeys[i]);\r\n                this.options.selectedItems.push(selectedItems[i])\r\n            }\r\n        }\r\n        this._initSelectedItemKeyHash();\r\n        this.updateSelectedItemKeyHash(this.options.selectedItemKeys)\r\n    },\r\n    _loadSelectedItemsCore: function(keys, isDeselect, isSelectAll) {\r\n        var deferred = new _deferred.Deferred;\r\n        var key = this.options.key();\r\n        if (!keys.length && !isSelectAll) {\r\n            deferred.resolve([]);\r\n            return deferred\r\n        }\r\n        var filter = this.options.filter();\r\n        if (isSelectAll && isDeselect && !filter) {\r\n            deferred.resolve(this.getSelectedItems());\r\n            return deferred\r\n        }\r\n        var selectionFilterCreator = new _selection_filter.SelectionFilterCreator(keys, isSelectAll);\r\n        var combinedFilter = selectionFilterCreator.getCombinedFilter(key, filter);\r\n        var deselectedItems = [];\r\n        if (isDeselect) {\r\n            deselectedItems = combinedFilter ? (0, _query.default)(this.options.selectedItems).filter(combinedFilter).toArray() : this.options.selectedItems.slice(0)\r\n        }\r\n        var filteredItems = deselectedItems.length ? deselectedItems : this.options.plainItems(true).filter(this.options.isSelectableItem).map(this.options.getItemData);\r\n        var localFilter = selectionFilterCreator.getLocalFilter(this.options.keyOf, this.equalKeys.bind(this), this.options.equalByReference, key);\r\n        filteredItems = filteredItems.filter(localFilter);\r\n        if (deselectedItems.length || !isSelectAll && filteredItems.length === keys.length) {\r\n            deferred.resolve(filteredItems)\r\n        } else {\r\n            deferred = this._loadFilteredData(combinedFilter, localFilter, null, isSelectAll)\r\n        }\r\n        return deferred\r\n    },\r\n    _replaceSelectionUpdate: function(items) {\r\n        var internalKeys = [];\r\n        var keyOf = this.options.keyOf;\r\n        if (!keyOf) {\r\n            return\r\n        }\r\n        for (var i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            var key = keyOf(item);\r\n            internalKeys.push(key)\r\n        }\r\n        this.setSelectedItems(internalKeys, items)\r\n    },\r\n    _warnOnIncorrectKeys: function(keys) {\r\n        var allowNullValue = this.options.allowNullValue;\r\n        for (var i = 0; i < keys.length; i++) {\r\n            var key = keys[i];\r\n            if ((!allowNullValue || null !== key) && !this.isItemKeySelected(key)) {\r\n                _ui.default.log(\"W1002\", key)\r\n            }\r\n        }\r\n    },\r\n    _isMultiSelectEnabled: function() {\r\n        var mode = this.options.mode;\r\n        return \"all\" === mode || \"multiple\" === mode\r\n    },\r\n    _requestInProgress: function() {\r\n        var _this$_lastLoadDeferr;\r\n        return \"pending\" === (null === (_this$_lastLoadDeferr = this._lastLoadDeferred) || void 0 === _this$_lastLoadDeferr ? void 0 : _this$_lastLoadDeferr.state())\r\n    },\r\n    _concatRequestsItems: function(keys, isDeselect, oldRequestItems) {\r\n        var deselectedItems = isDeselect ? keys : [];\r\n        return {\r\n            addedItems: oldRequestItems.added.concat((0, _array.removeDuplicates)(keys, this.options.selectedItemKeys)),\r\n            removedItems: oldRequestItems.removed.concat(deselectedItems),\r\n            keys: keys\r\n        }\r\n    },\r\n    _collectLastRequestData: function(keys, isDeselect, isSelectAll) {\r\n        var isDeselectAll = isDeselect && isSelectAll;\r\n        var oldRequestItems = {\r\n            added: [],\r\n            removed: []\r\n        };\r\n        var multiSelectEnabled = this._isMultiSelectEnabled();\r\n        var lastRequestData = multiSelectEnabled ? this._lastRequestData : {};\r\n        if (multiSelectEnabled) {\r\n            if (this._requestInProgress()) {\r\n                if (isDeselectAll) {\r\n                    this._lastLoadDeferred.reject();\r\n                    lastRequestData = {}\r\n                } else {\r\n                    if (!(0, _array_compare.isKeysEqual)(keys, this.options.selectedItemKeys)) {\r\n                        oldRequestItems.added = lastRequestData.addedItems;\r\n                        oldRequestItems.removed = lastRequestData.removedItems;\r\n                        if (!isDeselect) {\r\n                            this._lastLoadDeferred.reject()\r\n                        }\r\n                    } else {\r\n                        lastRequestData = {}\r\n                    }\r\n                }\r\n            }\r\n            lastRequestData = this._concatRequestsItems(keys, isDeselect, oldRequestItems)\r\n        }\r\n        return lastRequestData\r\n    },\r\n    _updateKeysByLastRequestData: function(keys, isDeselect, isSelectAll) {\r\n        var currentKeys = keys;\r\n        if (this._isMultiSelectEnabled() && !isDeselect && !isSelectAll) {\r\n            var _this$_lastRequestDat, _this$_lastRequestDat2;\r\n            currentKeys = (0, _array.removeDuplicates)(keys.concat(null === (_this$_lastRequestDat = this._lastRequestData) || void 0 === _this$_lastRequestDat ? void 0 : _this$_lastRequestDat.addedItems), null === (_this$_lastRequestDat2 = this._lastRequestData) || void 0 === _this$_lastRequestDat2 ? void 0 : _this$_lastRequestDat2.removedItems);\r\n            currentKeys = (0, _array.uniqueValues)(currentKeys)\r\n        }\r\n        return currentKeys\r\n    },\r\n    _loadSelectedItems: function(keys, isDeselect, isSelectAll) {\r\n        var that = this;\r\n        var deferred = new _deferred.Deferred;\r\n        this._lastRequestData = this._collectLastRequestData(keys, isDeselect, isSelectAll);\r\n        (0, _deferred.when)(that._lastLoadDeferred).always(function() {\r\n            var currentKeys = that._updateKeysByLastRequestData(keys, isDeselect, isSelectAll);\r\n            that._loadSelectedItemsCore(currentKeys, isDeselect, isSelectAll).done(deferred.resolve).fail(deferred.reject)\r\n        });\r\n        that._lastLoadDeferred = deferred;\r\n        return deferred\r\n    },\r\n    selectedItemKeys: function(keys, preserve, isDeselect, isSelectAll) {\r\n        var that = this;\r\n        var deferred = that._loadSelectedItems(keys, isDeselect, isSelectAll);\r\n        deferred.done(function(items) {\r\n            if (preserve) {\r\n                that._preserveSelectionUpdate(items, isDeselect)\r\n            } else {\r\n                that._replaceSelectionUpdate(items)\r\n            }\r\n            that.onSelectionChanged()\r\n        });\r\n        return deferred\r\n    },\r\n    addSelectedItem: function(key, itemData) {\r\n        if ((0, _type.isDefined)(itemData) && itemData.disabled) {\r\n            if (this.options.disabledItemKeys.indexOf(key) === -1) {\r\n                this.options.disabledItemKeys.push(key)\r\n            }\r\n            return\r\n        }\r\n        var keyHash = this._getKeyHash(key);\r\n        if (this._indexOfSelectedItemKey(keyHash) === -1) {\r\n            if (!(0, _type.isObject)(keyHash) && this.options.keyHashIndices) {\r\n                this.options.keyHashIndices[keyHash] = [this.options.selectedItemKeys.length]\r\n            }\r\n            this.options.selectedItemKeys.push(key);\r\n            this.options.addedItemKeys.push(key);\r\n            this.options.addedItems.push(itemData);\r\n            this.options.selectedItems.push(itemData)\r\n        }\r\n    },\r\n    _getSelectedIndexByKey: function(key, ignoreIndicesMap) {\r\n        var selectedItemKeys = this.options.selectedItemKeys;\r\n        for (var index = 0; index < selectedItemKeys.length; index++) {\r\n            if ((!ignoreIndicesMap || !ignoreIndicesMap[index]) && this.equalKeys(selectedItemKeys[index], key)) {\r\n                return index\r\n            }\r\n        }\r\n        return -1\r\n    },\r\n    _getSelectedIndexByHash: function(key, ignoreIndicesMap) {\r\n        var indices = this.options.keyHashIndices[key];\r\n        if (indices && indices.length > 1 && ignoreIndicesMap) {\r\n            indices = indices.filter(function(index) {\r\n                return !ignoreIndicesMap[index]\r\n            })\r\n        }\r\n        return indices && indices[0] >= 0 ? indices[0] : -1\r\n    },\r\n    _indexOfSelectedItemKey: function(key, ignoreIndicesMap) {\r\n        var selectedIndex;\r\n        if (this.options.equalByReference) {\r\n            selectedIndex = this.options.selectedItemKeys.indexOf(key)\r\n        } else {\r\n            if ((0, _type.isObject)(key)) {\r\n                selectedIndex = this._getSelectedIndexByKey(key, ignoreIndicesMap)\r\n            } else {\r\n                selectedIndex = this._getSelectedIndexByHash(key, ignoreIndicesMap)\r\n            }\r\n        }\r\n        return selectedIndex\r\n    },\r\n    _shiftSelectedKeyIndices: function(keyIndex) {\r\n        for (var currentKeyIndex = keyIndex; currentKeyIndex < this.options.selectedItemKeys.length; currentKeyIndex++) {\r\n            var currentKey = this.options.selectedItemKeys[currentKeyIndex];\r\n            var currentKeyHash = (0, _common.getKeyHash)(currentKey);\r\n            var currentKeyIndices = this.options.keyHashIndices[currentKeyHash];\r\n            if (!currentKeyIndices) {\r\n                continue\r\n            }\r\n            for (var i = 0; i < currentKeyIndices.length; i++) {\r\n                if (currentKeyIndices[i] > keyIndex) {\r\n                    currentKeyIndices[i]--\r\n                }\r\n            }\r\n        }\r\n    },\r\n    removeSelectedItem: function(key, keyIndicesToRemoveMap) {\r\n        var keyHash = this._getKeyHash(key);\r\n        var isBatchDeselect = !!keyIndicesToRemoveMap;\r\n        var keyIndex = this._indexOfSelectedItemKey(keyHash, keyIndicesToRemoveMap);\r\n        if (keyIndex < 0) {\r\n            return keyIndex\r\n        }\r\n        this.options.removedItemKeys.push(key);\r\n        this.options.removedItems.push(this.options.selectedItems[keyIndex]);\r\n        if (isBatchDeselect) {\r\n            return keyIndex\r\n        }\r\n        this.options.selectedItemKeys.splice(keyIndex, 1);\r\n        this.options.selectedItems.splice(keyIndex, 1);\r\n        if ((0, _type.isObject)(keyHash) || !this.options.keyHashIndices) {\r\n            return keyIndex\r\n        }\r\n        var keyIndices = this.options.keyHashIndices[keyHash];\r\n        if (!keyIndices) {\r\n            return keyIndex\r\n        }\r\n        keyIndices.shift();\r\n        if (!keyIndices.length) {\r\n            delete this.options.keyHashIndices[keyHash]\r\n        }\r\n        this._shiftSelectedKeyIndices(keyIndex);\r\n        return keyIndex\r\n    },\r\n    _updateAddedItemKeys: function(keys, items) {\r\n        for (var i = 0; i < keys.length; i++) {\r\n            if (!this.isItemKeySelected(keys[i])) {\r\n                this.options.addedItemKeys.push(keys[i]);\r\n                this.options.addedItems.push(items[i])\r\n            }\r\n        }\r\n    },\r\n    _updateRemovedItemKeys: function(keys, oldSelectedKeys, oldSelectedItems) {\r\n        for (var i = 0; i < oldSelectedKeys.length; i++) {\r\n            if (!this.isItemKeySelected(oldSelectedKeys[i])) {\r\n                this.options.removedItemKeys.push(oldSelectedKeys[i]);\r\n                this.options.removedItems.push(oldSelectedItems[i])\r\n            }\r\n        }\r\n    },\r\n    _isItemSelectionInProgress: function(key, checkPending) {\r\n        var shouldCheckPending = checkPending && this._lastRequestData && this._requestInProgress();\r\n        if (shouldCheckPending) {\r\n            return this._lastRequestData.addedItems && this._lastRequestData.addedItems.indexOf(key) !== -1\r\n        } else {\r\n            return false\r\n        }\r\n    },\r\n    _getKeyHash: function(key) {\r\n        return this.options.equalByReference ? key : (0, _common.getKeyHash)(key)\r\n    },\r\n    setSelectedItems: function(keys, items) {\r\n        this._updateAddedItemKeys(keys, items);\r\n        var oldSelectedKeys = this.options.selectedItemKeys;\r\n        var oldSelectedItems = this.options.selectedItems;\r\n        if (!this.options.equalByReference) {\r\n            this._initSelectedItemKeyHash();\r\n            this.updateSelectedItemKeyHash(keys)\r\n        }\r\n        this._setOption(\"selectedItemKeys\", keys);\r\n        this._setOption(\"selectedItems\", items);\r\n        this._updateRemovedItemKeys(keys, oldSelectedKeys, oldSelectedItems)\r\n    },\r\n    isItemDataSelected: function(itemData) {\r\n        var options = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\r\n        var key = this.options.keyOf(itemData);\r\n        return this.isItemKeySelected(key, options)\r\n    },\r\n    isItemKeySelected: function(key) {\r\n        var options = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\r\n        var result = this._isItemSelectionInProgress(key, options.checkPending);\r\n        if (!result) {\r\n            var keyHash = this._getKeyHash(key);\r\n            var index = this._indexOfSelectedItemKey(keyHash);\r\n            result = index !== -1\r\n        }\r\n        return result\r\n    },\r\n    getSelectAllState: function(visibleOnly) {\r\n        if (visibleOnly) {\r\n            return this._getVisibleSelectAllState()\r\n        } else {\r\n            return this._getFullSelectAllState()\r\n        }\r\n    }\r\n});\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}