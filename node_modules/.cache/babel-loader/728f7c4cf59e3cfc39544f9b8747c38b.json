{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/rendering_strategies/ui.scheduler.appointments.strategy.agenda.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _date = _interopRequireDefault(require(\"../../../core/utils/date\"));\n\nvar _iterator = require(\"../../../core/utils/iterator\");\n\nvar _array = require(\"../../../core/utils/array\");\n\nvar _uiSchedulerAppointmentsStrategy = _interopRequireDefault(require(\"./ui.scheduler.appointments.strategy.base\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nvar AgendaRenderingStrategy = function (_BaseAppointmentsStra) {\n  _inheritsLoose(AgendaRenderingStrategy, _BaseAppointmentsStra);\n\n  function AgendaRenderingStrategy() {\n    return _BaseAppointmentsStra.apply(this, arguments) || this;\n  }\n\n  var _proto = AgendaRenderingStrategy.prototype;\n\n  _proto.getAppointmentMinSize = function () {};\n\n  _proto.getDeltaTime = function () {};\n\n  _proto.keepAppointmentSettings = function () {\n    return true;\n  };\n\n  _proto.getAppointmentGeometry = function (geometry) {\n    return geometry;\n  };\n\n  _proto.createTaskPositionMap = function (appointments) {\n    var height;\n    var appointmentsByResources;\n\n    if (appointments.length) {\n      height = this.instance.fire(\"getAgendaVerticalStepHeight\");\n      appointmentsByResources = this.instance.fire(\"groupAppointmentsByResources\", appointments);\n      var groupedAppts = [];\n      (0, _iterator.each)(appointmentsByResources, function (i, appts) {\n        var additionalAppointments = [];\n        var recurrentIndexes = [];\n        (0, _iterator.each)(appts, function (index, appointment) {\n          var recurrenceBatch = this.instance.getAppointmentsInstance()._processRecurrenceAppointment(appointment, index);\n\n          var appointmentBatch = null;\n\n          if (!recurrenceBatch.indexes.length) {\n            appointmentBatch = {\n              parts: []\n            };\n            appointmentBatch = this.instance.getAppointmentsInstance()._processLongAppointment(appointment);\n            additionalAppointments = additionalAppointments.concat(appointmentBatch.parts);\n          }\n\n          additionalAppointments = additionalAppointments.concat(recurrenceBatch.parts);\n          recurrentIndexes = recurrentIndexes.concat(recurrenceBatch.indexes);\n        }.bind(this));\n\n        this.instance.getAppointmentsInstance()._reduceRecurrenceAppointments(recurrentIndexes, appts);\n\n        this.instance.getAppointmentsInstance()._combineAppointments(appts, additionalAppointments);\n\n        groupedAppts = groupedAppts.concat(appts);\n      }.bind(this));\n      Array.prototype.splice.apply(appointments, [0, appointments.length].concat(groupedAppts));\n    }\n\n    var result = [];\n    var sortedIndex = 0;\n    appointments.forEach(function (appt, index) {\n      result.push([{\n        height: height,\n        width: \"100%\",\n        sortedIndex: sortedIndex++,\n        groupIndex: this._calculateGroupIndex(index, appointmentsByResources),\n        agendaSettings: appt.settings\n      }]);\n      delete appt.settings;\n    }.bind(this));\n    return result;\n  };\n\n  _proto._calculateGroupIndex = function (apptIndex, appointmentsByResources) {\n    var resultInd;\n    var counter = 0;\n\n    for (var i in appointmentsByResources) {\n      var countApptInGroup = appointmentsByResources[i].length;\n\n      if (apptIndex >= counter && apptIndex < counter + countApptInGroup) {\n        resultInd = Number(i);\n        break;\n      }\n\n      counter += countApptInGroup;\n    }\n\n    return resultInd;\n  };\n\n  _proto._getDeltaWidth = function () {};\n\n  _proto._getAppointmentMaxWidth = function () {\n    return this.getDefaultCellWidth();\n  };\n\n  _proto._needVerifyItemSize = function () {\n    return false;\n  };\n\n  _proto._isRtl = function () {\n    return this.instance.option(\"rtlEnabled\");\n  };\n\n  _proto._getAppointmentParts = function () {};\n\n  _proto._reduceMultiWeekAppointment = function () {};\n\n  _proto.calculateAppointmentHeight = function () {\n    return 0;\n  };\n\n  _proto.calculateAppointmentWidth = function () {\n    return 0;\n  };\n\n  _proto.isAppointmentGreaterThan = function () {};\n\n  _proto.isAllDay = function () {\n    return false;\n  };\n\n  _proto._sortCondition = function () {};\n\n  _proto._rowCondition = function () {};\n\n  _proto._columnCondition = function () {};\n\n  _proto._findIndexByKey = function () {};\n\n  _proto._markAppointmentAsVirtual = function () {};\n\n  _proto.getDropDownAppointmentWidth = function () {};\n\n  _proto.getDefaultCellWidth = function () {\n    return this._defaultWidth;\n  };\n\n  _proto.getCollectorLeftOffset = function () {};\n\n  _proto.getCollectorTopOffset = function () {};\n\n  _proto.calculateRows = function (appointments, agendaDuration, currentDate, needClearSettings) {\n    this._rows = [];\n    var groupedAppointments = this.instance.fire(\"groupAppointmentsByResources\", appointments);\n    currentDate = _date.default.trimTime(new Date(currentDate));\n    (0, _iterator.each)(groupedAppointments, function (groupIndex, currentAppointments) {\n      var groupResult = [];\n      var appts = {\n        indexes: [],\n        parts: []\n      };\n\n      if (!currentAppointments.length) {\n        this._rows.push([]);\n\n        return true;\n      }\n\n      (0, _iterator.each)(currentAppointments, function (index, appointment) {\n        var startDate = this.instance.fire(\"getField\", \"startDate\", appointment);\n        var endDate = this.instance.fire(\"getField\", \"endDate\", appointment);\n        this.instance.fire(\"replaceWrongEndDate\", appointment, startDate, endDate);\n        needClearSettings && delete appointment.settings;\n\n        var result = this.instance.getAppointmentsInstance()._processRecurrenceAppointment(appointment, index, false);\n\n        appts.parts = appts.parts.concat(result.parts);\n        appts.indexes = appts.indexes.concat(result.indexes);\n      }.bind(this));\n\n      this.instance.getAppointmentsInstance()._reduceRecurrenceAppointments(appts.indexes, currentAppointments);\n\n      (0, _array.merge)(currentAppointments, appts.parts);\n      var appointmentCount = currentAppointments.length;\n\n      for (var i = 0; i < agendaDuration; i++) {\n        var day = new Date(currentDate);\n        day.setMilliseconds(day.getMilliseconds() + 864e5 * i);\n\n        if (void 0 === groupResult[i]) {\n          groupResult[i] = 0;\n        }\n\n        for (var j = 0; j < appointmentCount; j++) {\n          var appointmentData = currentAppointments[j].settings || currentAppointments[j];\n          var appointmentIsLong = this.instance.fire(\"appointmentTakesSeveralDays\", currentAppointments[j]);\n          var appointmentIsRecurrence = this.instance.fire(\"getField\", \"recurrenceRule\", currentAppointments[j]);\n\n          if (this.instance.fire(\"dayHasAppointment\", day, appointmentData, true) || !appointmentIsRecurrence && appointmentIsLong && this.instance.fire(\"dayHasAppointment\", day, currentAppointments[j], true)) {\n            groupResult[i] += 1;\n          }\n        }\n      }\n\n      this._rows.push(groupResult);\n    }.bind(this));\n    return this._rows;\n  };\n\n  _proto._iterateRow = function (row, obj, index) {\n    for (var i = 0; i < row.length; i++) {\n      obj.counter = obj.counter + row[i];\n\n      if (obj.counter >= index) {\n        obj.indexInRow = i;\n        break;\n      }\n    }\n  };\n\n  _proto.getDateByIndex = function (index, rows, startViewDate) {\n    var obj = {\n      counter: 0,\n      indexInRow: 0\n    };\n    index++;\n\n    for (var i = 0; i < rows.length; i++) {\n      this._iterateRow(rows[i], obj, index);\n\n      if (obj.indexInRow) {\n        break;\n      }\n    }\n\n    return new Date(new Date(startViewDate).setDate(startViewDate.getDate() + obj.indexInRow));\n  };\n\n  _proto.getAppointmentDataCalculator = function () {\n    return function ($appointment, originalStartDate) {\n      var apptIndex = $appointment.index();\n      var startViewDate = this.instance.getStartViewDate();\n      var calculatedStartDate = this.getDateByIndex(apptIndex, this._rows, startViewDate);\n      var wrappedOriginalStartDate = new Date(originalStartDate);\n      return {\n        startDate: new Date(calculatedStartDate.setHours(wrappedOriginalStartDate.getHours(), wrappedOriginalStartDate.getMinutes(), wrappedOriginalStartDate.getSeconds(), wrappedOriginalStartDate.getMilliseconds()))\n      };\n    }.bind(this);\n  };\n\n  return AgendaRenderingStrategy;\n}(_uiSchedulerAppointmentsStrategy.default);\n\nvar _default = AgendaRenderingStrategy;\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["/home/emma/node_modules/devextreme/ui/scheduler/rendering_strategies/ui.scheduler.appointments.strategy.agenda.js"],"names":["exports","default","_date","_interopRequireDefault","require","_iterator","_array","_uiSchedulerAppointmentsStrategy","obj","__esModule","_inheritsLoose","subClass","superClass","prototype","Object","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","AgendaRenderingStrategy","_BaseAppointmentsStra","apply","arguments","_proto","getAppointmentMinSize","getDeltaTime","keepAppointmentSettings","getAppointmentGeometry","geometry","createTaskPositionMap","appointments","height","appointmentsByResources","length","instance","fire","groupedAppts","each","i","appts","additionalAppointments","recurrentIndexes","index","appointment","recurrenceBatch","getAppointmentsInstance","_processRecurrenceAppointment","appointmentBatch","indexes","parts","_processLongAppointment","concat","bind","_reduceRecurrenceAppointments","_combineAppointments","Array","splice","result","sortedIndex","forEach","appt","push","width","groupIndex","_calculateGroupIndex","agendaSettings","settings","apptIndex","resultInd","counter","countApptInGroup","Number","_getDeltaWidth","_getAppointmentMaxWidth","getDefaultCellWidth","_needVerifyItemSize","_isRtl","option","_getAppointmentParts","_reduceMultiWeekAppointment","calculateAppointmentHeight","calculateAppointmentWidth","isAppointmentGreaterThan","isAllDay","_sortCondition","_rowCondition","_columnCondition","_findIndexByKey","_markAppointmentAsVirtual","getDropDownAppointmentWidth","_defaultWidth","getCollectorLeftOffset","getCollectorTopOffset","calculateRows","agendaDuration","currentDate","needClearSettings","_rows","groupedAppointments","trimTime","Date","currentAppointments","groupResult","startDate","endDate","merge","appointmentCount","day","setMilliseconds","getMilliseconds","j","appointmentData","appointmentIsLong","appointmentIsRecurrence","_iterateRow","row","indexInRow","getDateByIndex","rows","startViewDate","setDate","getDate","getAppointmentDataCalculator","$appointment","originalStartDate","getStartViewDate","calculatedStartDate","wrappedOriginalStartDate","setHours","getHours","getMinutes","getSeconds","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/rendering_strategies/ui.scheduler.appointments.strategy.agenda.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _date = _interopRequireDefault(require(\"../../../core/utils/date\"));\r\nvar _iterator = require(\"../../../core/utils/iterator\");\r\nvar _array = require(\"../../../core/utils/array\");\r\nvar _uiSchedulerAppointmentsStrategy = _interopRequireDefault(require(\"./ui.scheduler.appointments.strategy.base\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _inheritsLoose(subClass, superClass) {\r\n    subClass.prototype = Object.create(superClass.prototype);\r\n    subClass.prototype.constructor = subClass;\r\n    _setPrototypeOf(subClass, superClass)\r\n}\r\n\r\nfunction _setPrototypeOf(o, p) {\r\n    _setPrototypeOf = Object.setPrototypeOf || function(o, p) {\r\n        o.__proto__ = p;\r\n        return o\r\n    };\r\n    return _setPrototypeOf(o, p)\r\n}\r\nvar AgendaRenderingStrategy = function(_BaseAppointmentsStra) {\r\n    _inheritsLoose(AgendaRenderingStrategy, _BaseAppointmentsStra);\r\n\r\n    function AgendaRenderingStrategy() {\r\n        return _BaseAppointmentsStra.apply(this, arguments) || this\r\n    }\r\n    var _proto = AgendaRenderingStrategy.prototype;\r\n    _proto.getAppointmentMinSize = function() {};\r\n    _proto.getDeltaTime = function() {};\r\n    _proto.keepAppointmentSettings = function() {\r\n        return true\r\n    };\r\n    _proto.getAppointmentGeometry = function(geometry) {\r\n        return geometry\r\n    };\r\n    _proto.createTaskPositionMap = function(appointments) {\r\n        var height;\r\n        var appointmentsByResources;\r\n        if (appointments.length) {\r\n            height = this.instance.fire(\"getAgendaVerticalStepHeight\");\r\n            appointmentsByResources = this.instance.fire(\"groupAppointmentsByResources\", appointments);\r\n            var groupedAppts = [];\r\n            (0, _iterator.each)(appointmentsByResources, function(i, appts) {\r\n                var additionalAppointments = [];\r\n                var recurrentIndexes = [];\r\n                (0, _iterator.each)(appts, function(index, appointment) {\r\n                    var recurrenceBatch = this.instance.getAppointmentsInstance()._processRecurrenceAppointment(appointment, index);\r\n                    var appointmentBatch = null;\r\n                    if (!recurrenceBatch.indexes.length) {\r\n                        appointmentBatch = {\r\n                            parts: []\r\n                        };\r\n                        appointmentBatch = this.instance.getAppointmentsInstance()._processLongAppointment(appointment);\r\n                        additionalAppointments = additionalAppointments.concat(appointmentBatch.parts)\r\n                    }\r\n                    additionalAppointments = additionalAppointments.concat(recurrenceBatch.parts);\r\n                    recurrentIndexes = recurrentIndexes.concat(recurrenceBatch.indexes)\r\n                }.bind(this));\r\n                this.instance.getAppointmentsInstance()._reduceRecurrenceAppointments(recurrentIndexes, appts);\r\n                this.instance.getAppointmentsInstance()._combineAppointments(appts, additionalAppointments);\r\n                groupedAppts = groupedAppts.concat(appts)\r\n            }.bind(this));\r\n            Array.prototype.splice.apply(appointments, [0, appointments.length].concat(groupedAppts))\r\n        }\r\n        var result = [];\r\n        var sortedIndex = 0;\r\n        appointments.forEach(function(appt, index) {\r\n            result.push([{\r\n                height: height,\r\n                width: \"100%\",\r\n                sortedIndex: sortedIndex++,\r\n                groupIndex: this._calculateGroupIndex(index, appointmentsByResources),\r\n                agendaSettings: appt.settings\r\n            }]);\r\n            delete appt.settings\r\n        }.bind(this));\r\n        return result\r\n    };\r\n    _proto._calculateGroupIndex = function(apptIndex, appointmentsByResources) {\r\n        var resultInd;\r\n        var counter = 0;\r\n        for (var i in appointmentsByResources) {\r\n            var countApptInGroup = appointmentsByResources[i].length;\r\n            if (apptIndex >= counter && apptIndex < counter + countApptInGroup) {\r\n                resultInd = Number(i);\r\n                break\r\n            }\r\n            counter += countApptInGroup\r\n        }\r\n        return resultInd\r\n    };\r\n    _proto._getDeltaWidth = function() {};\r\n    _proto._getAppointmentMaxWidth = function() {\r\n        return this.getDefaultCellWidth()\r\n    };\r\n    _proto._needVerifyItemSize = function() {\r\n        return false\r\n    };\r\n    _proto._isRtl = function() {\r\n        return this.instance.option(\"rtlEnabled\")\r\n    };\r\n    _proto._getAppointmentParts = function() {};\r\n    _proto._reduceMultiWeekAppointment = function() {};\r\n    _proto.calculateAppointmentHeight = function() {\r\n        return 0\r\n    };\r\n    _proto.calculateAppointmentWidth = function() {\r\n        return 0\r\n    };\r\n    _proto.isAppointmentGreaterThan = function() {};\r\n    _proto.isAllDay = function() {\r\n        return false\r\n    };\r\n    _proto._sortCondition = function() {};\r\n    _proto._rowCondition = function() {};\r\n    _proto._columnCondition = function() {};\r\n    _proto._findIndexByKey = function() {};\r\n    _proto._markAppointmentAsVirtual = function() {};\r\n    _proto.getDropDownAppointmentWidth = function() {};\r\n    _proto.getDefaultCellWidth = function() {\r\n        return this._defaultWidth\r\n    };\r\n    _proto.getCollectorLeftOffset = function() {};\r\n    _proto.getCollectorTopOffset = function() {};\r\n    _proto.calculateRows = function(appointments, agendaDuration, currentDate, needClearSettings) {\r\n        this._rows = [];\r\n        var groupedAppointments = this.instance.fire(\"groupAppointmentsByResources\", appointments);\r\n        currentDate = _date.default.trimTime(new Date(currentDate));\r\n        (0, _iterator.each)(groupedAppointments, function(groupIndex, currentAppointments) {\r\n            var groupResult = [];\r\n            var appts = {\r\n                indexes: [],\r\n                parts: []\r\n            };\r\n            if (!currentAppointments.length) {\r\n                this._rows.push([]);\r\n                return true\r\n            }(0, _iterator.each)(currentAppointments, function(index, appointment) {\r\n                var startDate = this.instance.fire(\"getField\", \"startDate\", appointment);\r\n                var endDate = this.instance.fire(\"getField\", \"endDate\", appointment);\r\n                this.instance.fire(\"replaceWrongEndDate\", appointment, startDate, endDate);\r\n                needClearSettings && delete appointment.settings;\r\n                var result = this.instance.getAppointmentsInstance()._processRecurrenceAppointment(appointment, index, false);\r\n                appts.parts = appts.parts.concat(result.parts);\r\n                appts.indexes = appts.indexes.concat(result.indexes)\r\n            }.bind(this));\r\n            this.instance.getAppointmentsInstance()._reduceRecurrenceAppointments(appts.indexes, currentAppointments);\r\n            (0, _array.merge)(currentAppointments, appts.parts);\r\n            var appointmentCount = currentAppointments.length;\r\n            for (var i = 0; i < agendaDuration; i++) {\r\n                var day = new Date(currentDate);\r\n                day.setMilliseconds(day.getMilliseconds() + 864e5 * i);\r\n                if (void 0 === groupResult[i]) {\r\n                    groupResult[i] = 0\r\n                }\r\n                for (var j = 0; j < appointmentCount; j++) {\r\n                    var appointmentData = currentAppointments[j].settings || currentAppointments[j];\r\n                    var appointmentIsLong = this.instance.fire(\"appointmentTakesSeveralDays\", currentAppointments[j]);\r\n                    var appointmentIsRecurrence = this.instance.fire(\"getField\", \"recurrenceRule\", currentAppointments[j]);\r\n                    if (this.instance.fire(\"dayHasAppointment\", day, appointmentData, true) || !appointmentIsRecurrence && appointmentIsLong && this.instance.fire(\"dayHasAppointment\", day, currentAppointments[j], true)) {\r\n                        groupResult[i] += 1\r\n                    }\r\n                }\r\n            }\r\n            this._rows.push(groupResult)\r\n        }.bind(this));\r\n        return this._rows\r\n    };\r\n    _proto._iterateRow = function(row, obj, index) {\r\n        for (var i = 0; i < row.length; i++) {\r\n            obj.counter = obj.counter + row[i];\r\n            if (obj.counter >= index) {\r\n                obj.indexInRow = i;\r\n                break\r\n            }\r\n        }\r\n    };\r\n    _proto.getDateByIndex = function(index, rows, startViewDate) {\r\n        var obj = {\r\n            counter: 0,\r\n            indexInRow: 0\r\n        };\r\n        index++;\r\n        for (var i = 0; i < rows.length; i++) {\r\n            this._iterateRow(rows[i], obj, index);\r\n            if (obj.indexInRow) {\r\n                break\r\n            }\r\n        }\r\n        return new Date(new Date(startViewDate).setDate(startViewDate.getDate() + obj.indexInRow))\r\n    };\r\n    _proto.getAppointmentDataCalculator = function() {\r\n        return function($appointment, originalStartDate) {\r\n            var apptIndex = $appointment.index();\r\n            var startViewDate = this.instance.getStartViewDate();\r\n            var calculatedStartDate = this.getDateByIndex(apptIndex, this._rows, startViewDate);\r\n            var wrappedOriginalStartDate = new Date(originalStartDate);\r\n            return {\r\n                startDate: new Date(calculatedStartDate.setHours(wrappedOriginalStartDate.getHours(), wrappedOriginalStartDate.getMinutes(), wrappedOriginalStartDate.getSeconds(), wrappedOriginalStartDate.getMilliseconds()))\r\n            }\r\n        }.bind(this)\r\n    };\r\n    return AgendaRenderingStrategy\r\n}(_uiSchedulerAppointmentsStrategy.default);\r\nvar _default = AgendaRenderingStrategy;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}