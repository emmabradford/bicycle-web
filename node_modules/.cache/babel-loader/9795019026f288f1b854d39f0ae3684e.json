{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.resource_manager.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _object = require(\"../../core/utils/object\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _query = _interopRequireDefault(require(\"../../data/query\"));\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _utils = require(\"../../data/data_source/utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar getValueExpr = function getValueExpr(resource) {\n  return resource.valueExpr || \"id\";\n};\n\nvar getDisplayExpr = function getDisplayExpr(resource) {\n  return resource.displayExpr || \"text\";\n};\n\nvar ResourceManager = function () {\n  function ResourceManager(resources) {\n    this._resourceLoader = {};\n    this.setResources(resources);\n  }\n\n  var _proto = ResourceManager.prototype;\n\n  _proto._createWrappedDataSource = function (dataSource) {\n    if (dataSource instanceof _data_source.DataSource) {\n      return dataSource;\n    }\n\n    var result = {\n      store: (0, _utils.normalizeDataSourceOptions)(dataSource).store,\n      pageSize: 0\n    };\n\n    if (!Array.isArray(dataSource)) {\n      result.filter = dataSource.filter;\n    }\n\n    return new _data_source.DataSource(result);\n  };\n\n  _proto._mapResourceData = function (resource, data) {\n    var valueGetter = (0, _data.compileGetter)(getValueExpr(resource));\n    var displayGetter = (0, _data.compileGetter)(getDisplayExpr(resource));\n    return (0, _iterator.map)(data, function (item) {\n      var result = {\n        id: valueGetter(item),\n        text: displayGetter(item)\n      };\n\n      if (item.color) {\n        result.color = item.color;\n      }\n\n      return result;\n    });\n  };\n\n  _proto._isMultipleResource = function (resourceField) {\n    var result = false;\n    (0, _iterator.each)(this.getResources(), function (_, resource) {\n      var field = this.getField(resource);\n\n      if (field === resourceField) {\n        result = resource.allowMultiple;\n        return false;\n      }\n    }.bind(this));\n    return result;\n  };\n\n  _proto.getDataAccessors = function (field, type) {\n    var result = null;\n    (0, _iterator.each)(this._dataAccessors[type], function (accessorName, accessors) {\n      if (field === accessorName) {\n        result = accessors;\n        return false;\n      }\n    });\n    return result;\n  };\n\n  _proto.getField = function (resource) {\n    return resource.fieldExpr || resource.field;\n  };\n\n  _proto.setResources = function (resources) {\n    this._resources = resources;\n    this._dataAccessors = {\n      getter: {},\n      setter: {}\n    };\n    this._resourceFields = (0, _iterator.map)(resources || [], function (resource) {\n      var field = this.getField(resource);\n      this._dataAccessors.getter[field] = (0, _data.compileGetter)(field);\n      this._dataAccessors.setter[field] = (0, _data.compileSetter)(field);\n      return field;\n    }.bind(this));\n  };\n\n  _proto.getResources = function () {\n    return this._resources || [];\n  };\n\n  _proto.getResourcesData = function () {\n    return this._resourcesData || [];\n  };\n\n  _proto.getEditors = function () {\n    var result = [];\n    var that = this;\n    (0, _iterator.each)(this.getResources(), function (i, resource) {\n      var field = that.getField(resource);\n\n      var currentResourceItems = that._getResourceDataByField(field);\n\n      result.push({\n        editorOptions: {\n          dataSource: currentResourceItems.length ? currentResourceItems : that._createWrappedDataSource(resource.dataSource),\n          displayExpr: getDisplayExpr(resource),\n          valueExpr: getValueExpr(resource)\n        },\n        dataField: field,\n        editorType: resource.allowMultiple ? \"dxTagBox\" : \"dxSelectBox\",\n        label: {\n          text: resource.label || field\n        }\n      });\n    });\n    return result;\n  };\n\n  _proto.getResourceDataByValue = function (field, value) {\n    var that = this;\n    var result = new _deferred.Deferred();\n    (0, _iterator.each)(this.getResources(), function (_, resource) {\n      var resourceField = that.getField(resource);\n\n      if (resourceField === field) {\n        var dataSource = that._createWrappedDataSource(resource.dataSource);\n\n        var valueExpr = getValueExpr(resource);\n\n        if (!that._resourceLoader[field]) {\n          that._resourceLoader[field] = dataSource.load();\n        }\n\n        that._resourceLoader[field].done(function (data) {\n          var filteredData = (0, _query.default)(data).filter(valueExpr, value).toArray();\n          delete that._resourceLoader[field];\n          result.resolve(filteredData[0]);\n        }).fail(function () {\n          delete that._resourceLoader[field];\n          result.reject();\n        });\n\n        return false;\n      }\n    });\n    return result.promise();\n  };\n\n  _proto.setResourcesToItem = function (itemData, resources) {\n    var resourcesSetter = this._dataAccessors.setter;\n\n    for (var name in resources) {\n      if (Object.prototype.hasOwnProperty.call(resources, name)) {\n        var resourceData = resources[name];\n        resourcesSetter[name](itemData, this._isMultipleResource(name) ? (0, _array.wrapToArray)(resourceData) : resourceData);\n      }\n    }\n  };\n\n  _proto.getResourcesFromItem = function (itemData, wrapOnlyMultipleResources) {\n    var _this = this;\n\n    var result = null;\n\n    if (!(0, _type.isDefined)(wrapOnlyMultipleResources)) {\n      wrapOnlyMultipleResources = false;\n    }\n\n    this._resourceFields.forEach(function (field) {\n      (0, _iterator.each)(itemData, function (fieldName, fieldValue) {\n        var tempObject = {};\n        tempObject[fieldName] = fieldValue;\n\n        var resourceData = _this.getDataAccessors(field, \"getter\")(tempObject);\n\n        if ((0, _type.isDefined)(resourceData)) {\n          if (!result) {\n            result = {};\n          }\n\n          if (1 === resourceData.length) {\n            resourceData = resourceData[0];\n          }\n\n          if (!wrapOnlyMultipleResources || wrapOnlyMultipleResources && _this._isMultipleResource(field)) {\n            _this.getDataAccessors(field, \"setter\")(tempObject, (0, _array.wrapToArray)(resourceData));\n          } else {\n            _this.getDataAccessors(field, \"setter\")(tempObject, resourceData);\n          }\n\n          (0, _extend.extend)(result, tempObject);\n          return true;\n        }\n      });\n    });\n\n    return result;\n  };\n\n  _proto.loadResources = function (groups) {\n    var result = new _deferred.Deferred();\n    var that = this;\n    var deferreds = [];\n    (0, _iterator.each)(this.getResourcesByFields(groups), function (i, resource) {\n      var deferred = new _deferred.Deferred();\n      var field = that.getField(resource);\n      deferreds.push(deferred);\n\n      that._createWrappedDataSource(resource.dataSource).load().done(function (data) {\n        deferred.resolve({\n          name: field,\n          items: that._mapResourceData(resource, data),\n          data: data\n        });\n      }).fail(function () {\n        deferred.reject();\n      });\n    });\n\n    if (!deferreds.length) {\n      that._resourcesData = [];\n      return result.resolve([]);\n    }\n\n    _deferred.when.apply(null, deferreds).done(function () {\n      var data = Array.prototype.slice.call(arguments);\n\n      var mapFunction = function mapFunction(obj) {\n        return {\n          name: obj.name,\n          items: obj.items,\n          data: obj.data\n        };\n      };\n\n      that._resourcesData = data;\n      result.resolve(data.map(mapFunction));\n    }).fail(function () {\n      result.reject();\n    });\n\n    return result.promise();\n  };\n\n  _proto.getResourcesByFields = function (fields) {\n    return (0, _common.grep)(this.getResources(), function (resource) {\n      var field = this.getField(resource);\n      return (0, _array.inArray)(field, fields) > -1;\n    }.bind(this));\n  };\n\n  _proto.getResourceByField = function (field) {\n    return this.getResourcesByFields([field])[0] || {};\n  };\n\n  _proto.getResourceColor = function (field, value) {\n    var valueExpr = this.getResourceByField(field).valueExpr || \"id\";\n    var valueGetter = (0, _data.compileGetter)(valueExpr);\n    var colorExpr = this.getResourceByField(field).colorExpr || \"color\";\n    var colorGetter = (0, _data.compileGetter)(colorExpr);\n    var result = new _deferred.Deferred();\n\n    var resourceData = this._getResourceDataByField(field);\n\n    var resourceDataLength = resourceData.length;\n    var color;\n\n    if (resourceDataLength) {\n      for (var i = 0; i < resourceDataLength; i++) {\n        if (valueGetter(resourceData[i]) === value) {\n          color = colorGetter(resourceData[i]);\n          break;\n        }\n      }\n\n      result.resolve(color);\n    } else {\n      this.getResourceDataByValue(field, value).done(function (resourceData) {\n        if (resourceData) {\n          color = colorGetter(resourceData);\n        }\n\n        result.resolve(color);\n      }).fail(function () {\n        result.reject();\n      });\n    }\n\n    return result.promise();\n  };\n\n  _proto.getResourceForPainting = function (groups) {\n    var resources = this.getResources();\n    var result;\n    (0, _iterator.each)(resources, function (index, resource) {\n      if (resource.useColorAsDefault) {\n        result = resource;\n        return false;\n      }\n    });\n\n    if (!result) {\n      if (Array.isArray(groups) && groups.length) {\n        resources = this.getResourcesByFields(groups);\n      }\n\n      result = resources[resources.length - 1];\n    }\n\n    return result;\n  };\n\n  _proto.createResourcesTree = function (groups) {\n    var leafIndex = 0;\n    var groupIndex = groupIndex || 0;\n\n    function make(group, groupIndex, result, parent) {\n      result = result || [];\n\n      for (var i = 0; i < group.items.length; i++) {\n        var currentGroupItem = group.items[i];\n        var resultItem = {\n          name: group.name,\n          value: currentGroupItem.id,\n          title: currentGroupItem.text,\n          data: group.data && group.data[i],\n          children: [],\n          parent: parent ? parent : null\n        };\n        result.push(resultItem);\n        var nextGroupIndex = groupIndex + 1;\n\n        if (groups[nextGroupIndex]) {\n          make.call(this, groups[nextGroupIndex], nextGroupIndex, resultItem.children, resultItem);\n        }\n\n        if (!resultItem.children.length) {\n          resultItem.leafIndex = leafIndex;\n          leafIndex++;\n        }\n      }\n\n      return result;\n    }\n\n    return make.call(this, groups[0], 0);\n  };\n\n  _proto._hasGroupItem = function (appointmentResources, groupName, itemValue) {\n    var group = this.getDataAccessors(groupName, \"getter\")(appointmentResources);\n\n    if (group) {\n      if ((0, _array.inArray)(itemValue, group) > -1) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  _proto._getResourceDataByField = function (fieldName) {\n    var loadedResources = this.getResourcesData();\n    var currentResourceData = [];\n\n    for (var i = 0, resourceCount = loadedResources.length; i < resourceCount; i++) {\n      if (loadedResources[i].name === fieldName) {\n        currentResourceData = loadedResources[i].data;\n        break;\n      }\n    }\n\n    return currentResourceData;\n  };\n\n  _proto.getResourceTreeLeaves = function (tree, appointmentResources, result) {\n    result = result || [];\n\n    for (var i = 0; i < tree.length; i++) {\n      if (!this._hasGroupItem(appointmentResources, tree[i].name, tree[i].value)) {\n        continue;\n      }\n\n      if ((0, _type.isDefined)(tree[i].leafIndex)) {\n        result.push(tree[i].leafIndex);\n      }\n\n      if (tree[i].children) {\n        this.getResourceTreeLeaves(tree[i].children, appointmentResources, result);\n      }\n    }\n\n    return result;\n  };\n\n  _proto.groupAppointmentsByResources = function (appointments, resources) {\n    var tree = this.createResourcesTree(resources);\n    var result = {};\n    (0, _iterator.each)(appointments, function (_, appointment) {\n      var appointmentResources = this.getResourcesFromItem(appointment);\n      var treeLeaves = this.getResourceTreeLeaves(tree, appointmentResources);\n\n      for (var i = 0; i < treeLeaves.length; i++) {\n        if (!result[treeLeaves[i]]) {\n          result[treeLeaves[i]] = [];\n        }\n\n        result[treeLeaves[i]].push((0, _object.deepExtendArraySafe)({}, appointment, true));\n      }\n    }.bind(this));\n    return result;\n  };\n\n  _proto.reduceResourcesTree = function (tree, existingAppointments, _result) {\n    _result = _result ? _result.children : [];\n    var that = this;\n    tree.forEach(function (node, index) {\n      var ok = false;\n      var resourceName = node.name;\n      var resourceValue = node.value;\n      var resourceTitle = node.title;\n      var resourceData = node.data;\n      var resourceGetter = that.getDataAccessors(resourceName, \"getter\");\n      existingAppointments.forEach(function (appointment) {\n        if (!ok) {\n          var resourceFromAppointment = resourceGetter(appointment);\n\n          if (Array.isArray(resourceFromAppointment)) {\n            if (resourceFromAppointment.indexOf(resourceValue) > -1) {\n              _result.push({\n                name: resourceName,\n                value: resourceValue,\n                title: resourceTitle,\n                data: resourceData,\n                children: []\n              });\n\n              ok = true;\n            }\n          } else {\n            if (resourceFromAppointment === resourceValue) {\n              _result.push({\n                name: resourceName,\n                value: resourceValue,\n                title: resourceTitle,\n                data: resourceData,\n                children: []\n              });\n\n              ok = true;\n            }\n          }\n        }\n      });\n\n      if (ok && node.children && node.children.length) {\n        that.reduceResourcesTree(node.children, existingAppointments, _result[index]);\n      }\n    });\n    return _result;\n  };\n\n  _proto.getResourcesDataByGroups = function (groups) {\n    var _this2 = this;\n\n    var resourcesData = this.getResourcesData();\n\n    if (!groups) {\n      return resourcesData;\n    }\n\n    var fieldNames = Object.getOwnPropertyNames(groups);\n    var resourceData = resourcesData.filter(function (item) {\n      return fieldNames.indexOf(item.name) !== -1;\n    });\n    var currentResourcesData = [];\n    resourceData.forEach(function (data) {\n      return currentResourcesData.push((0, _extend.extend)({}, data));\n    });\n    (0, _iterator.each)(groups, function (_, value) {\n      currentResourcesData.forEach(function (resourceData) {\n        var items = resourceData.items,\n            data = resourceData.data,\n            name = resourceData.name;\n\n        var resource = _this2.getResourceByField(name);\n\n        var valueExpr = getValueExpr(resource);\n        var currentItems = items.filter(function (item) {\n          return item.id === value;\n        });\n        var currentData = data.filter(function (item) {\n          return item[valueExpr] === value;\n        });\n        resourceData.items = currentItems;\n        resourceData.data = currentData;\n      });\n    });\n    return currentResourcesData;\n  };\n\n  return ResourceManager;\n}();\n\nexports.default = ResourceManager;\nmodule.exports = exports.default;","map":{"version":3,"sources":["/home/emma/node_modules/devextreme/ui/scheduler/ui.scheduler.resource_manager.js"],"names":["exports","default","_array","require","_common","_type","_object","_iterator","_extend","_query","_interopRequireDefault","_data","_data_source","_deferred","_utils","obj","__esModule","getValueExpr","resource","valueExpr","getDisplayExpr","displayExpr","ResourceManager","resources","_resourceLoader","setResources","_proto","prototype","_createWrappedDataSource","dataSource","DataSource","result","store","normalizeDataSourceOptions","pageSize","Array","isArray","filter","_mapResourceData","data","valueGetter","compileGetter","displayGetter","map","item","id","text","color","_isMultipleResource","resourceField","each","getResources","_","field","getField","allowMultiple","bind","getDataAccessors","type","_dataAccessors","accessorName","accessors","fieldExpr","_resources","getter","setter","_resourceFields","compileSetter","getResourcesData","_resourcesData","getEditors","that","i","currentResourceItems","_getResourceDataByField","push","editorOptions","length","dataField","editorType","label","getResourceDataByValue","value","Deferred","load","done","filteredData","toArray","resolve","fail","reject","promise","setResourcesToItem","itemData","resourcesSetter","name","Object","hasOwnProperty","call","resourceData","wrapToArray","getResourcesFromItem","wrapOnlyMultipleResources","_this","isDefined","forEach","fieldName","fieldValue","tempObject","extend","loadResources","groups","deferreds","getResourcesByFields","deferred","items","when","apply","slice","arguments","mapFunction","fields","grep","inArray","getResourceByField","getResourceColor","colorExpr","colorGetter","resourceDataLength","getResourceForPainting","index","useColorAsDefault","createResourcesTree","leafIndex","groupIndex","make","group","parent","currentGroupItem","resultItem","title","children","nextGroupIndex","_hasGroupItem","appointmentResources","groupName","itemValue","loadedResources","currentResourceData","resourceCount","getResourceTreeLeaves","tree","groupAppointmentsByResources","appointments","appointment","treeLeaves","deepExtendArraySafe","reduceResourcesTree","existingAppointments","_result","node","ok","resourceName","resourceValue","resourceTitle","resourceGetter","resourceFromAppointment","indexOf","getResourcesDataByGroups","_this2","resourcesData","fieldNames","getOwnPropertyNames","currentResourcesData","currentItems","currentData","module"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAA,OAAO,CAACC,OAAR,GAAkB,KAAK,CAAvB;;AACA,IAAIC,MAAM,GAAGC,OAAO,CAAC,wBAAD,CAApB;;AACA,IAAIC,OAAO,GAAGD,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIE,KAAK,GAAGF,OAAO,CAAC,uBAAD,CAAnB;;AACA,IAAIG,OAAO,GAAGH,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAII,SAAS,GAAGJ,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAIK,OAAO,GAAGL,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIM,MAAM,GAAGC,sBAAsB,CAACP,OAAO,CAAC,kBAAD,CAAR,CAAnC;;AACA,IAAIQ,KAAK,GAAGR,OAAO,CAAC,uBAAD,CAAnB;;AACA,IAAIS,YAAY,GAAGT,OAAO,CAAC,oCAAD,CAA1B;;AACA,IAAIU,SAAS,GAAGV,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAIW,MAAM,GAAGX,OAAO,CAAC,8BAAD,CAApB;;AAEA,SAASO,sBAAT,CAAgCK,GAAhC,EAAqC;AACjC,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACD,IAAIE,YAAY,GAAG,SAAfA,YAAe,CAASC,QAAT,EAAmB;AAClC,SAAOA,QAAQ,CAACC,SAAT,IAAsB,IAA7B;AACH,CAFD;;AAGA,IAAIC,cAAc,GAAG,SAAjBA,cAAiB,CAASF,QAAT,EAAmB;AACpC,SAAOA,QAAQ,CAACG,WAAT,IAAwB,MAA/B;AACH,CAFD;;AAGA,IAAIC,eAAe,GAAG,YAAW;AAC7B,WAASA,eAAT,CAAyBC,SAAzB,EAAoC;AAChC,SAAKC,eAAL,GAAuB,EAAvB;AACA,SAAKC,YAAL,CAAkBF,SAAlB;AACH;;AACD,MAAIG,MAAM,GAAGJ,eAAe,CAACK,SAA7B;;AACAD,EAAAA,MAAM,CAACE,wBAAP,GAAkC,UAASC,UAAT,EAAqB;AACnD,QAAIA,UAAU,YAAYjB,YAAY,CAACkB,UAAvC,EAAmD;AAC/C,aAAOD,UAAP;AACH;;AACD,QAAIE,MAAM,GAAG;AACTC,MAAAA,KAAK,EAAE,CAAC,GAAGlB,MAAM,CAACmB,0BAAX,EAAuCJ,UAAvC,EAAmDG,KADjD;AAETE,MAAAA,QAAQ,EAAE;AAFD,KAAb;;AAIA,QAAI,CAACC,KAAK,CAACC,OAAN,CAAcP,UAAd,CAAL,EAAgC;AAC5BE,MAAAA,MAAM,CAACM,MAAP,GAAgBR,UAAU,CAACQ,MAA3B;AACH;;AACD,WAAO,IAAIzB,YAAY,CAACkB,UAAjB,CAA4BC,MAA5B,CAAP;AACH,GAZD;;AAaAL,EAAAA,MAAM,CAACY,gBAAP,GAA0B,UAASpB,QAAT,EAAmBqB,IAAnB,EAAyB;AAC/C,QAAIC,WAAW,GAAG,CAAC,GAAG7B,KAAK,CAAC8B,aAAV,EAAyBxB,YAAY,CAACC,QAAD,CAArC,CAAlB;AACA,QAAIwB,aAAa,GAAG,CAAC,GAAG/B,KAAK,CAAC8B,aAAV,EAAyBrB,cAAc,CAACF,QAAD,CAAvC,CAApB;AACA,WAAO,CAAC,GAAGX,SAAS,CAACoC,GAAd,EAAmBJ,IAAnB,EAAyB,UAASK,IAAT,EAAe;AAC3C,UAAIb,MAAM,GAAG;AACTc,QAAAA,EAAE,EAAEL,WAAW,CAACI,IAAD,CADN;AAETE,QAAAA,IAAI,EAAEJ,aAAa,CAACE,IAAD;AAFV,OAAb;;AAIA,UAAIA,IAAI,CAACG,KAAT,EAAgB;AACZhB,QAAAA,MAAM,CAACgB,KAAP,GAAeH,IAAI,CAACG,KAApB;AACH;;AACD,aAAOhB,MAAP;AACH,KATM,CAAP;AAUH,GAbD;;AAcAL,EAAAA,MAAM,CAACsB,mBAAP,GAA6B,UAASC,aAAT,EAAwB;AACjD,QAAIlB,MAAM,GAAG,KAAb;AACA,KAAC,GAAGxB,SAAS,CAAC2C,IAAd,EAAoB,KAAKC,YAAL,EAApB,EAAyC,UAASC,CAAT,EAAYlC,QAAZ,EAAsB;AAC3D,UAAImC,KAAK,GAAG,KAAKC,QAAL,CAAcpC,QAAd,CAAZ;;AACA,UAAImC,KAAK,KAAKJ,aAAd,EAA6B;AACzBlB,QAAAA,MAAM,GAAGb,QAAQ,CAACqC,aAAlB;AACA,eAAO,KAAP;AACH;AACJ,KANwC,CAMvCC,IANuC,CAMlC,IANkC,CAAzC;AAOA,WAAOzB,MAAP;AACH,GAVD;;AAWAL,EAAAA,MAAM,CAAC+B,gBAAP,GAA0B,UAASJ,KAAT,EAAgBK,IAAhB,EAAsB;AAC5C,QAAI3B,MAAM,GAAG,IAAb;AACA,KAAC,GAAGxB,SAAS,CAAC2C,IAAd,EAAoB,KAAKS,cAAL,CAAoBD,IAApB,CAApB,EAA+C,UAASE,YAAT,EAAuBC,SAAvB,EAAkC;AAC7E,UAAIR,KAAK,KAAKO,YAAd,EAA4B;AACxB7B,QAAAA,MAAM,GAAG8B,SAAT;AACA,eAAO,KAAP;AACH;AACJ,KALD;AAMA,WAAO9B,MAAP;AACH,GATD;;AAUAL,EAAAA,MAAM,CAAC4B,QAAP,GAAkB,UAASpC,QAAT,EAAmB;AACjC,WAAOA,QAAQ,CAAC4C,SAAT,IAAsB5C,QAAQ,CAACmC,KAAtC;AACH,GAFD;;AAGA3B,EAAAA,MAAM,CAACD,YAAP,GAAsB,UAASF,SAAT,EAAoB;AACtC,SAAKwC,UAAL,GAAkBxC,SAAlB;AACA,SAAKoC,cAAL,GAAsB;AAClBK,MAAAA,MAAM,EAAE,EADU;AAElBC,MAAAA,MAAM,EAAE;AAFU,KAAtB;AAIA,SAAKC,eAAL,GAAuB,CAAC,GAAG3D,SAAS,CAACoC,GAAd,EAAmBpB,SAAS,IAAI,EAAhC,EAAoC,UAASL,QAAT,EAAmB;AAC1E,UAAImC,KAAK,GAAG,KAAKC,QAAL,CAAcpC,QAAd,CAAZ;AACA,WAAKyC,cAAL,CAAoBK,MAApB,CAA2BX,KAA3B,IAAoC,CAAC,GAAG1C,KAAK,CAAC8B,aAAV,EAAyBY,KAAzB,CAApC;AACA,WAAKM,cAAL,CAAoBM,MAApB,CAA2BZ,KAA3B,IAAoC,CAAC,GAAG1C,KAAK,CAACwD,aAAV,EAAyBd,KAAzB,CAApC;AACA,aAAOA,KAAP;AACH,KAL0D,CAKzDG,IALyD,CAKpD,IALoD,CAApC,CAAvB;AAMH,GAZD;;AAaA9B,EAAAA,MAAM,CAACyB,YAAP,GAAsB,YAAW;AAC7B,WAAO,KAAKY,UAAL,IAAmB,EAA1B;AACH,GAFD;;AAGArC,EAAAA,MAAM,CAAC0C,gBAAP,GAA0B,YAAW;AACjC,WAAO,KAAKC,cAAL,IAAuB,EAA9B;AACH,GAFD;;AAGA3C,EAAAA,MAAM,CAAC4C,UAAP,GAAoB,YAAW;AAC3B,QAAIvC,MAAM,GAAG,EAAb;AACA,QAAIwC,IAAI,GAAG,IAAX;AACA,KAAC,GAAGhE,SAAS,CAAC2C,IAAd,EAAoB,KAAKC,YAAL,EAApB,EAAyC,UAASqB,CAAT,EAAYtD,QAAZ,EAAsB;AAC3D,UAAImC,KAAK,GAAGkB,IAAI,CAACjB,QAAL,CAAcpC,QAAd,CAAZ;;AACA,UAAIuD,oBAAoB,GAAGF,IAAI,CAACG,uBAAL,CAA6BrB,KAA7B,CAA3B;;AACAtB,MAAAA,MAAM,CAAC4C,IAAP,CAAY;AACRC,QAAAA,aAAa,EAAE;AACX/C,UAAAA,UAAU,EAAE4C,oBAAoB,CAACI,MAArB,GAA8BJ,oBAA9B,GAAqDF,IAAI,CAAC3C,wBAAL,CAA8BV,QAAQ,CAACW,UAAvC,CADtD;AAEXR,UAAAA,WAAW,EAAED,cAAc,CAACF,QAAD,CAFhB;AAGXC,UAAAA,SAAS,EAAEF,YAAY,CAACC,QAAD;AAHZ,SADP;AAMR4D,QAAAA,SAAS,EAAEzB,KANH;AAOR0B,QAAAA,UAAU,EAAE7D,QAAQ,CAACqC,aAAT,GAAyB,UAAzB,GAAsC,aAP1C;AAQRyB,QAAAA,KAAK,EAAE;AACHlC,UAAAA,IAAI,EAAE5B,QAAQ,CAAC8D,KAAT,IAAkB3B;AADrB;AARC,OAAZ;AAYH,KAfD;AAgBA,WAAOtB,MAAP;AACH,GApBD;;AAqBAL,EAAAA,MAAM,CAACuD,sBAAP,GAAgC,UAAS5B,KAAT,EAAgB6B,KAAhB,EAAuB;AACnD,QAAIX,IAAI,GAAG,IAAX;AACA,QAAIxC,MAAM,GAAG,IAAIlB,SAAS,CAACsE,QAAd,EAAb;AACA,KAAC,GAAG5E,SAAS,CAAC2C,IAAd,EAAoB,KAAKC,YAAL,EAApB,EAAyC,UAASC,CAAT,EAAYlC,QAAZ,EAAsB;AAC3D,UAAI+B,aAAa,GAAGsB,IAAI,CAACjB,QAAL,CAAcpC,QAAd,CAApB;;AACA,UAAI+B,aAAa,KAAKI,KAAtB,EAA6B;AACzB,YAAIxB,UAAU,GAAG0C,IAAI,CAAC3C,wBAAL,CAA8BV,QAAQ,CAACW,UAAvC,CAAjB;;AACA,YAAIV,SAAS,GAAGF,YAAY,CAACC,QAAD,CAA5B;;AACA,YAAI,CAACqD,IAAI,CAAC/C,eAAL,CAAqB6B,KAArB,CAAL,EAAkC;AAC9BkB,UAAAA,IAAI,CAAC/C,eAAL,CAAqB6B,KAArB,IAA8BxB,UAAU,CAACuD,IAAX,EAA9B;AACH;;AACDb,QAAAA,IAAI,CAAC/C,eAAL,CAAqB6B,KAArB,EAA4BgC,IAA5B,CAAiC,UAAS9C,IAAT,EAAe;AAC5C,cAAI+C,YAAY,GAAG,CAAC,GAAG7E,MAAM,CAACR,OAAX,EAAoBsC,IAApB,EAA0BF,MAA1B,CAAiClB,SAAjC,EAA4C+D,KAA5C,EAAmDK,OAAnD,EAAnB;AACA,iBAAOhB,IAAI,CAAC/C,eAAL,CAAqB6B,KAArB,CAAP;AACAtB,UAAAA,MAAM,CAACyD,OAAP,CAAeF,YAAY,CAAC,CAAD,CAA3B;AACH,SAJD,EAIGG,IAJH,CAIQ,YAAW;AACf,iBAAOlB,IAAI,CAAC/C,eAAL,CAAqB6B,KAArB,CAAP;AACAtB,UAAAA,MAAM,CAAC2D,MAAP;AACH,SAPD;;AAQA,eAAO,KAAP;AACH;AACJ,KAlBD;AAmBA,WAAO3D,MAAM,CAAC4D,OAAP,EAAP;AACH,GAvBD;;AAwBAjE,EAAAA,MAAM,CAACkE,kBAAP,GAA4B,UAASC,QAAT,EAAmBtE,SAAnB,EAA8B;AACtD,QAAIuE,eAAe,GAAG,KAAKnC,cAAL,CAAoBM,MAA1C;;AACA,SAAK,IAAI8B,IAAT,IAAiBxE,SAAjB,EAA4B;AACxB,UAAIyE,MAAM,CAACrE,SAAP,CAAiBsE,cAAjB,CAAgCC,IAAhC,CAAqC3E,SAArC,EAAgDwE,IAAhD,CAAJ,EAA2D;AACvD,YAAII,YAAY,GAAG5E,SAAS,CAACwE,IAAD,CAA5B;AACAD,QAAAA,eAAe,CAACC,IAAD,CAAf,CAAsBF,QAAtB,EAAgC,KAAK7C,mBAAL,CAAyB+C,IAAzB,IAAiC,CAAC,GAAG7F,MAAM,CAACkG,WAAX,EAAwBD,YAAxB,CAAjC,GAAyEA,YAAzG;AACH;AACJ;AACJ,GARD;;AASAzE,EAAAA,MAAM,CAAC2E,oBAAP,GAA8B,UAASR,QAAT,EAAmBS,yBAAnB,EAA8C;AACxE,QAAIC,KAAK,GAAG,IAAZ;;AACA,QAAIxE,MAAM,GAAG,IAAb;;AACA,QAAI,CAAC,CAAC,GAAG1B,KAAK,CAACmG,SAAV,EAAqBF,yBAArB,CAAL,EAAsD;AAClDA,MAAAA,yBAAyB,GAAG,KAA5B;AACH;;AACD,SAAKpC,eAAL,CAAqBuC,OAArB,CAA6B,UAASpD,KAAT,EAAgB;AACzC,OAAC,GAAG9C,SAAS,CAAC2C,IAAd,EAAoB2C,QAApB,EAA8B,UAASa,SAAT,EAAoBC,UAApB,EAAgC;AAC1D,YAAIC,UAAU,GAAG,EAAjB;AACAA,QAAAA,UAAU,CAACF,SAAD,CAAV,GAAwBC,UAAxB;;AACA,YAAIR,YAAY,GAAGI,KAAK,CAAC9C,gBAAN,CAAuBJ,KAAvB,EAA8B,QAA9B,EAAwCuD,UAAxC,CAAnB;;AACA,YAAI,CAAC,GAAGvG,KAAK,CAACmG,SAAV,EAAqBL,YAArB,CAAJ,EAAwC;AACpC,cAAI,CAACpE,MAAL,EAAa;AACTA,YAAAA,MAAM,GAAG,EAAT;AACH;;AACD,cAAI,MAAMoE,YAAY,CAACtB,MAAvB,EAA+B;AAC3BsB,YAAAA,YAAY,GAAGA,YAAY,CAAC,CAAD,CAA3B;AACH;;AACD,cAAI,CAACG,yBAAD,IAA8BA,yBAAyB,IAAIC,KAAK,CAACvD,mBAAN,CAA0BK,KAA1B,CAA/D,EAAiG;AAC7FkD,YAAAA,KAAK,CAAC9C,gBAAN,CAAuBJ,KAAvB,EAA8B,QAA9B,EAAwCuD,UAAxC,EAAoD,CAAC,GAAG1G,MAAM,CAACkG,WAAX,EAAwBD,YAAxB,CAApD;AACH,WAFD,MAEO;AACHI,YAAAA,KAAK,CAAC9C,gBAAN,CAAuBJ,KAAvB,EAA8B,QAA9B,EAAwCuD,UAAxC,EAAoDT,YAApD;AACH;;AAAA,WAAC,GAAG3F,OAAO,CAACqG,MAAZ,EAAoB9E,MAApB,EAA4B6E,UAA5B;AACD,iBAAO,IAAP;AACH;AACJ,OAlBD;AAmBH,KApBD;;AAqBA,WAAO7E,MAAP;AACH,GA5BD;;AA6BAL,EAAAA,MAAM,CAACoF,aAAP,GAAuB,UAASC,MAAT,EAAiB;AACpC,QAAIhF,MAAM,GAAG,IAAIlB,SAAS,CAACsE,QAAd,EAAb;AACA,QAAIZ,IAAI,GAAG,IAAX;AACA,QAAIyC,SAAS,GAAG,EAAhB;AACA,KAAC,GAAGzG,SAAS,CAAC2C,IAAd,EAAoB,KAAK+D,oBAAL,CAA0BF,MAA1B,CAApB,EAAuD,UAASvC,CAAT,EAAYtD,QAAZ,EAAsB;AACzE,UAAIgG,QAAQ,GAAG,IAAIrG,SAAS,CAACsE,QAAd,EAAf;AACA,UAAI9B,KAAK,GAAGkB,IAAI,CAACjB,QAAL,CAAcpC,QAAd,CAAZ;AACA8F,MAAAA,SAAS,CAACrC,IAAV,CAAeuC,QAAf;;AACA3C,MAAAA,IAAI,CAAC3C,wBAAL,CAA8BV,QAAQ,CAACW,UAAvC,EAAmDuD,IAAnD,GAA0DC,IAA1D,CAA+D,UAAS9C,IAAT,EAAe;AAC1E2E,QAAAA,QAAQ,CAAC1B,OAAT,CAAiB;AACbO,UAAAA,IAAI,EAAE1C,KADO;AAEb8D,UAAAA,KAAK,EAAE5C,IAAI,CAACjC,gBAAL,CAAsBpB,QAAtB,EAAgCqB,IAAhC,CAFM;AAGbA,UAAAA,IAAI,EAAEA;AAHO,SAAjB;AAKH,OAND,EAMGkD,IANH,CAMQ,YAAW;AACfyB,QAAAA,QAAQ,CAACxB,MAAT;AACH,OARD;AASH,KAbD;;AAcA,QAAI,CAACsB,SAAS,CAACnC,MAAf,EAAuB;AACnBN,MAAAA,IAAI,CAACF,cAAL,GAAsB,EAAtB;AACA,aAAOtC,MAAM,CAACyD,OAAP,CAAe,EAAf,CAAP;AACH;;AACD3E,IAAAA,SAAS,CAACuG,IAAV,CAAeC,KAAf,CAAqB,IAArB,EAA2BL,SAA3B,EAAsC3B,IAAtC,CAA2C,YAAW;AAClD,UAAI9C,IAAI,GAAGJ,KAAK,CAACR,SAAN,CAAgB2F,KAAhB,CAAsBpB,IAAtB,CAA2BqB,SAA3B,CAAX;;AACA,UAAIC,WAAW,GAAG,SAAdA,WAAc,CAASzG,GAAT,EAAc;AAC5B,eAAO;AACHgF,UAAAA,IAAI,EAAEhF,GAAG,CAACgF,IADP;AAEHoB,UAAAA,KAAK,EAAEpG,GAAG,CAACoG,KAFR;AAGH5E,UAAAA,IAAI,EAAExB,GAAG,CAACwB;AAHP,SAAP;AAKH,OAND;;AAOAgC,MAAAA,IAAI,CAACF,cAAL,GAAsB9B,IAAtB;AACAR,MAAAA,MAAM,CAACyD,OAAP,CAAejD,IAAI,CAACI,GAAL,CAAS6E,WAAT,CAAf;AACH,KAXD,EAWG/B,IAXH,CAWQ,YAAW;AACf1D,MAAAA,MAAM,CAAC2D,MAAP;AACH,KAbD;;AAcA,WAAO3D,MAAM,CAAC4D,OAAP,EAAP;AACH,GArCD;;AAsCAjE,EAAAA,MAAM,CAACuF,oBAAP,GAA8B,UAASQ,MAAT,EAAiB;AAC3C,WAAO,CAAC,GAAGrH,OAAO,CAACsH,IAAZ,EAAkB,KAAKvE,YAAL,EAAlB,EAAuC,UAASjC,QAAT,EAAmB;AAC7D,UAAImC,KAAK,GAAG,KAAKC,QAAL,CAAcpC,QAAd,CAAZ;AACA,aAAO,CAAC,GAAGhB,MAAM,CAACyH,OAAX,EAAoBtE,KAApB,EAA2BoE,MAA3B,IAAqC,CAAC,CAA7C;AACH,KAH6C,CAG5CjE,IAH4C,CAGvC,IAHuC,CAAvC,CAAP;AAIH,GALD;;AAMA9B,EAAAA,MAAM,CAACkG,kBAAP,GAA4B,UAASvE,KAAT,EAAgB;AACxC,WAAO,KAAK4D,oBAAL,CAA0B,CAAC5D,KAAD,CAA1B,EAAmC,CAAnC,KAAyC,EAAhD;AACH,GAFD;;AAGA3B,EAAAA,MAAM,CAACmG,gBAAP,GAA0B,UAASxE,KAAT,EAAgB6B,KAAhB,EAAuB;AAC7C,QAAI/D,SAAS,GAAG,KAAKyG,kBAAL,CAAwBvE,KAAxB,EAA+BlC,SAA/B,IAA4C,IAA5D;AACA,QAAIqB,WAAW,GAAG,CAAC,GAAG7B,KAAK,CAAC8B,aAAV,EAAyBtB,SAAzB,CAAlB;AACA,QAAI2G,SAAS,GAAG,KAAKF,kBAAL,CAAwBvE,KAAxB,EAA+ByE,SAA/B,IAA4C,OAA5D;AACA,QAAIC,WAAW,GAAG,CAAC,GAAGpH,KAAK,CAAC8B,aAAV,EAAyBqF,SAAzB,CAAlB;AACA,QAAI/F,MAAM,GAAG,IAAIlB,SAAS,CAACsE,QAAd,EAAb;;AACA,QAAIgB,YAAY,GAAG,KAAKzB,uBAAL,CAA6BrB,KAA7B,CAAnB;;AACA,QAAI2E,kBAAkB,GAAG7B,YAAY,CAACtB,MAAtC;AACA,QAAI9B,KAAJ;;AACA,QAAIiF,kBAAJ,EAAwB;AACpB,WAAK,IAAIxD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwD,kBAApB,EAAwCxD,CAAC,EAAzC,EAA6C;AACzC,YAAIhC,WAAW,CAAC2D,YAAY,CAAC3B,CAAD,CAAb,CAAX,KAAiCU,KAArC,EAA4C;AACxCnC,UAAAA,KAAK,GAAGgF,WAAW,CAAC5B,YAAY,CAAC3B,CAAD,CAAb,CAAnB;AACA;AACH;AACJ;;AACDzC,MAAAA,MAAM,CAACyD,OAAP,CAAezC,KAAf;AACH,KARD,MAQO;AACH,WAAKkC,sBAAL,CAA4B5B,KAA5B,EAAmC6B,KAAnC,EAA0CG,IAA1C,CAA+C,UAASc,YAAT,EAAuB;AAClE,YAAIA,YAAJ,EAAkB;AACdpD,UAAAA,KAAK,GAAGgF,WAAW,CAAC5B,YAAD,CAAnB;AACH;;AACDpE,QAAAA,MAAM,CAACyD,OAAP,CAAezC,KAAf;AACH,OALD,EAKG0C,IALH,CAKQ,YAAW;AACf1D,QAAAA,MAAM,CAAC2D,MAAP;AACH,OAPD;AAQH;;AACD,WAAO3D,MAAM,CAAC4D,OAAP,EAAP;AACH,GA5BD;;AA6BAjE,EAAAA,MAAM,CAACuG,sBAAP,GAAgC,UAASlB,MAAT,EAAiB;AAC7C,QAAIxF,SAAS,GAAG,KAAK4B,YAAL,EAAhB;AACA,QAAIpB,MAAJ;AACA,KAAC,GAAGxB,SAAS,CAAC2C,IAAd,EAAoB3B,SAApB,EAA+B,UAAS2G,KAAT,EAAgBhH,QAAhB,EAA0B;AACrD,UAAIA,QAAQ,CAACiH,iBAAb,EAAgC;AAC5BpG,QAAAA,MAAM,GAAGb,QAAT;AACA,eAAO,KAAP;AACH;AACJ,KALD;;AAMA,QAAI,CAACa,MAAL,EAAa;AACT,UAAII,KAAK,CAACC,OAAN,CAAc2E,MAAd,KAAyBA,MAAM,CAAClC,MAApC,EAA4C;AACxCtD,QAAAA,SAAS,GAAG,KAAK0F,oBAAL,CAA0BF,MAA1B,CAAZ;AACH;;AACDhF,MAAAA,MAAM,GAAGR,SAAS,CAACA,SAAS,CAACsD,MAAV,GAAmB,CAApB,CAAlB;AACH;;AACD,WAAO9C,MAAP;AACH,GAhBD;;AAiBAL,EAAAA,MAAM,CAAC0G,mBAAP,GAA6B,UAASrB,MAAT,EAAiB;AAC1C,QAAIsB,SAAS,GAAG,CAAhB;AACA,QAAIC,UAAU,GAAGA,UAAU,IAAI,CAA/B;;AAEA,aAASC,IAAT,CAAcC,KAAd,EAAqBF,UAArB,EAAiCvG,MAAjC,EAAyC0G,MAAzC,EAAiD;AAC7C1G,MAAAA,MAAM,GAAGA,MAAM,IAAI,EAAnB;;AACA,WAAK,IAAIyC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgE,KAAK,CAACrB,KAAN,CAAYtC,MAAhC,EAAwCL,CAAC,EAAzC,EAA6C;AACzC,YAAIkE,gBAAgB,GAAGF,KAAK,CAACrB,KAAN,CAAY3C,CAAZ,CAAvB;AACA,YAAImE,UAAU,GAAG;AACb5C,UAAAA,IAAI,EAAEyC,KAAK,CAACzC,IADC;AAEbb,UAAAA,KAAK,EAAEwD,gBAAgB,CAAC7F,EAFX;AAGb+F,UAAAA,KAAK,EAAEF,gBAAgB,CAAC5F,IAHX;AAIbP,UAAAA,IAAI,EAAEiG,KAAK,CAACjG,IAAN,IAAciG,KAAK,CAACjG,IAAN,CAAWiC,CAAX,CAJP;AAKbqE,UAAAA,QAAQ,EAAE,EALG;AAMbJ,UAAAA,MAAM,EAAEA,MAAM,GAAGA,MAAH,GAAY;AANb,SAAjB;AAQA1G,QAAAA,MAAM,CAAC4C,IAAP,CAAYgE,UAAZ;AACA,YAAIG,cAAc,GAAGR,UAAU,GAAG,CAAlC;;AACA,YAAIvB,MAAM,CAAC+B,cAAD,CAAV,EAA4B;AACxBP,UAAAA,IAAI,CAACrC,IAAL,CAAU,IAAV,EAAgBa,MAAM,CAAC+B,cAAD,CAAtB,EAAwCA,cAAxC,EAAwDH,UAAU,CAACE,QAAnE,EAA6EF,UAA7E;AACH;;AACD,YAAI,CAACA,UAAU,CAACE,QAAX,CAAoBhE,MAAzB,EAAiC;AAC7B8D,UAAAA,UAAU,CAACN,SAAX,GAAuBA,SAAvB;AACAA,UAAAA,SAAS;AACZ;AACJ;;AACD,aAAOtG,MAAP;AACH;;AACD,WAAOwG,IAAI,CAACrC,IAAL,CAAU,IAAV,EAAgBa,MAAM,CAAC,CAAD,CAAtB,EAA2B,CAA3B,CAAP;AACH,GA7BD;;AA8BArF,EAAAA,MAAM,CAACqH,aAAP,GAAuB,UAASC,oBAAT,EAA+BC,SAA/B,EAA0CC,SAA1C,EAAqD;AACxE,QAAIV,KAAK,GAAG,KAAK/E,gBAAL,CAAsBwF,SAAtB,EAAiC,QAAjC,EAA2CD,oBAA3C,CAAZ;;AACA,QAAIR,KAAJ,EAAW;AACP,UAAI,CAAC,GAAGtI,MAAM,CAACyH,OAAX,EAAoBuB,SAApB,EAA+BV,KAA/B,IAAwC,CAAC,CAA7C,EAAgD;AAC5C,eAAO,IAAP;AACH;AACJ;;AACD,WAAO,KAAP;AACH,GARD;;AASA9G,EAAAA,MAAM,CAACgD,uBAAP,GAAiC,UAASgC,SAAT,EAAoB;AACjD,QAAIyC,eAAe,GAAG,KAAK/E,gBAAL,EAAtB;AACA,QAAIgF,mBAAmB,GAAG,EAA1B;;AACA,SAAK,IAAI5E,CAAC,GAAG,CAAR,EAAW6E,aAAa,GAAGF,eAAe,CAACtE,MAAhD,EAAwDL,CAAC,GAAG6E,aAA5D,EAA2E7E,CAAC,EAA5E,EAAgF;AAC5E,UAAI2E,eAAe,CAAC3E,CAAD,CAAf,CAAmBuB,IAAnB,KAA4BW,SAAhC,EAA2C;AACvC0C,QAAAA,mBAAmB,GAAGD,eAAe,CAAC3E,CAAD,CAAf,CAAmBjC,IAAzC;AACA;AACH;AACJ;;AACD,WAAO6G,mBAAP;AACH,GAVD;;AAWA1H,EAAAA,MAAM,CAAC4H,qBAAP,GAA+B,UAASC,IAAT,EAAeP,oBAAf,EAAqCjH,MAArC,EAA6C;AACxEA,IAAAA,MAAM,GAAGA,MAAM,IAAI,EAAnB;;AACA,SAAK,IAAIyC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+E,IAAI,CAAC1E,MAAzB,EAAiCL,CAAC,EAAlC,EAAsC;AAClC,UAAI,CAAC,KAAKuE,aAAL,CAAmBC,oBAAnB,EAAyCO,IAAI,CAAC/E,CAAD,CAAJ,CAAQuB,IAAjD,EAAuDwD,IAAI,CAAC/E,CAAD,CAAJ,CAAQU,KAA/D,CAAL,EAA4E;AACxE;AACH;;AACD,UAAI,CAAC,GAAG7E,KAAK,CAACmG,SAAV,EAAqB+C,IAAI,CAAC/E,CAAD,CAAJ,CAAQ6D,SAA7B,CAAJ,EAA6C;AACzCtG,QAAAA,MAAM,CAAC4C,IAAP,CAAY4E,IAAI,CAAC/E,CAAD,CAAJ,CAAQ6D,SAApB;AACH;;AACD,UAAIkB,IAAI,CAAC/E,CAAD,CAAJ,CAAQqE,QAAZ,EAAsB;AAClB,aAAKS,qBAAL,CAA2BC,IAAI,CAAC/E,CAAD,CAAJ,CAAQqE,QAAnC,EAA6CG,oBAA7C,EAAmEjH,MAAnE;AACH;AACJ;;AACD,WAAOA,MAAP;AACH,GAdD;;AAeAL,EAAAA,MAAM,CAAC8H,4BAAP,GAAsC,UAASC,YAAT,EAAuBlI,SAAvB,EAAkC;AACpE,QAAIgI,IAAI,GAAG,KAAKnB,mBAAL,CAAyB7G,SAAzB,CAAX;AACA,QAAIQ,MAAM,GAAG,EAAb;AACA,KAAC,GAAGxB,SAAS,CAAC2C,IAAd,EAAoBuG,YAApB,EAAkC,UAASrG,CAAT,EAAYsG,WAAZ,EAAyB;AACvD,UAAIV,oBAAoB,GAAG,KAAK3C,oBAAL,CAA0BqD,WAA1B,CAA3B;AACA,UAAIC,UAAU,GAAG,KAAKL,qBAAL,CAA2BC,IAA3B,EAAiCP,oBAAjC,CAAjB;;AACA,WAAK,IAAIxE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmF,UAAU,CAAC9E,MAA/B,EAAuCL,CAAC,EAAxC,EAA4C;AACxC,YAAI,CAACzC,MAAM,CAAC4H,UAAU,CAACnF,CAAD,CAAX,CAAX,EAA4B;AACxBzC,UAAAA,MAAM,CAAC4H,UAAU,CAACnF,CAAD,CAAX,CAAN,GAAwB,EAAxB;AACH;;AACDzC,QAAAA,MAAM,CAAC4H,UAAU,CAACnF,CAAD,CAAX,CAAN,CAAsBG,IAAtB,CAA2B,CAAC,GAAGrE,OAAO,CAACsJ,mBAAZ,EAAiC,EAAjC,EAAqCF,WAArC,EAAkD,IAAlD,CAA3B;AACH;AACJ,KATiC,CAShClG,IATgC,CAS3B,IAT2B,CAAlC;AAUA,WAAOzB,MAAP;AACH,GAdD;;AAeAL,EAAAA,MAAM,CAACmI,mBAAP,GAA6B,UAASN,IAAT,EAAeO,oBAAf,EAAqCC,OAArC,EAA8C;AACvEA,IAAAA,OAAO,GAAGA,OAAO,GAAGA,OAAO,CAAClB,QAAX,GAAsB,EAAvC;AACA,QAAItE,IAAI,GAAG,IAAX;AACAgF,IAAAA,IAAI,CAAC9C,OAAL,CAAa,UAASuD,IAAT,EAAe9B,KAAf,EAAsB;AAC/B,UAAI+B,EAAE,GAAG,KAAT;AACA,UAAIC,YAAY,GAAGF,IAAI,CAACjE,IAAxB;AACA,UAAIoE,aAAa,GAAGH,IAAI,CAAC9E,KAAzB;AACA,UAAIkF,aAAa,GAAGJ,IAAI,CAACpB,KAAzB;AACA,UAAIzC,YAAY,GAAG6D,IAAI,CAACzH,IAAxB;AACA,UAAI8H,cAAc,GAAG9F,IAAI,CAACd,gBAAL,CAAsByG,YAAtB,EAAoC,QAApC,CAArB;AACAJ,MAAAA,oBAAoB,CAACrD,OAArB,CAA6B,UAASiD,WAAT,EAAsB;AAC/C,YAAI,CAACO,EAAL,EAAS;AACL,cAAIK,uBAAuB,GAAGD,cAAc,CAACX,WAAD,CAA5C;;AACA,cAAIvH,KAAK,CAACC,OAAN,CAAckI,uBAAd,CAAJ,EAA4C;AACxC,gBAAIA,uBAAuB,CAACC,OAAxB,CAAgCJ,aAAhC,IAAiD,CAAC,CAAtD,EAAyD;AACrDJ,cAAAA,OAAO,CAACpF,IAAR,CAAa;AACToB,gBAAAA,IAAI,EAAEmE,YADG;AAEThF,gBAAAA,KAAK,EAAEiF,aAFE;AAGTvB,gBAAAA,KAAK,EAAEwB,aAHE;AAIT7H,gBAAAA,IAAI,EAAE4D,YAJG;AAKT0C,gBAAAA,QAAQ,EAAE;AALD,eAAb;;AAOAoB,cAAAA,EAAE,GAAG,IAAL;AACH;AACJ,WAXD,MAWO;AACH,gBAAIK,uBAAuB,KAAKH,aAAhC,EAA+C;AAC3CJ,cAAAA,OAAO,CAACpF,IAAR,CAAa;AACToB,gBAAAA,IAAI,EAAEmE,YADG;AAEThF,gBAAAA,KAAK,EAAEiF,aAFE;AAGTvB,gBAAAA,KAAK,EAAEwB,aAHE;AAIT7H,gBAAAA,IAAI,EAAE4D,YAJG;AAKT0C,gBAAAA,QAAQ,EAAE;AALD,eAAb;;AAOAoB,cAAAA,EAAE,GAAG,IAAL;AACH;AACJ;AACJ;AACJ,OA3BD;;AA4BA,UAAIA,EAAE,IAAID,IAAI,CAACnB,QAAX,IAAuBmB,IAAI,CAACnB,QAAL,CAAchE,MAAzC,EAAiD;AAC7CN,QAAAA,IAAI,CAACsF,mBAAL,CAAyBG,IAAI,CAACnB,QAA9B,EAAwCiB,oBAAxC,EAA8DC,OAAO,CAAC7B,KAAD,CAArE;AACH;AACJ,KAtCD;AAuCA,WAAO6B,OAAP;AACH,GA3CD;;AA4CArI,EAAAA,MAAM,CAAC8I,wBAAP,GAAkC,UAASzD,MAAT,EAAiB;AAC/C,QAAI0D,MAAM,GAAG,IAAb;;AACA,QAAIC,aAAa,GAAG,KAAKtG,gBAAL,EAApB;;AACA,QAAI,CAAC2C,MAAL,EAAa;AACT,aAAO2D,aAAP;AACH;;AACD,QAAIC,UAAU,GAAG3E,MAAM,CAAC4E,mBAAP,CAA2B7D,MAA3B,CAAjB;AACA,QAAIZ,YAAY,GAAGuE,aAAa,CAACrI,MAAd,CAAqB,UAASO,IAAT,EAAe;AACnD,aAAO+H,UAAU,CAACJ,OAAX,CAAmB3H,IAAI,CAACmD,IAAxB,MAAkC,CAAC,CAA1C;AACH,KAFkB,CAAnB;AAGA,QAAI8E,oBAAoB,GAAG,EAA3B;AACA1E,IAAAA,YAAY,CAACM,OAAb,CAAqB,UAASlE,IAAT,EAAe;AAChC,aAAOsI,oBAAoB,CAAClG,IAArB,CAA0B,CAAC,GAAGnE,OAAO,CAACqG,MAAZ,EAAoB,EAApB,EAAwBtE,IAAxB,CAA1B,CAAP;AACH,KAFD;AAGA,KAAC,GAAGhC,SAAS,CAAC2C,IAAd,EAAoB6D,MAApB,EAA4B,UAAS3D,CAAT,EAAY8B,KAAZ,EAAmB;AAC3C2F,MAAAA,oBAAoB,CAACpE,OAArB,CAA6B,UAASN,YAAT,EAAuB;AAChD,YAAIgB,KAAK,GAAGhB,YAAY,CAACgB,KAAzB;AAAA,YACI5E,IAAI,GAAG4D,YAAY,CAAC5D,IADxB;AAAA,YAEIwD,IAAI,GAAGI,YAAY,CAACJ,IAFxB;;AAGA,YAAI7E,QAAQ,GAAGuJ,MAAM,CAAC7C,kBAAP,CAA0B7B,IAA1B,CAAf;;AACA,YAAI5E,SAAS,GAAGF,YAAY,CAACC,QAAD,CAA5B;AACA,YAAI4J,YAAY,GAAG3D,KAAK,CAAC9E,MAAN,CAAa,UAASO,IAAT,EAAe;AAC3C,iBAAOA,IAAI,CAACC,EAAL,KAAYqC,KAAnB;AACH,SAFkB,CAAnB;AAGA,YAAI6F,WAAW,GAAGxI,IAAI,CAACF,MAAL,CAAY,UAASO,IAAT,EAAe;AACzC,iBAAOA,IAAI,CAACzB,SAAD,CAAJ,KAAoB+D,KAA3B;AACH,SAFiB,CAAlB;AAGAiB,QAAAA,YAAY,CAACgB,KAAb,GAAqB2D,YAArB;AACA3E,QAAAA,YAAY,CAAC5D,IAAb,GAAoBwI,WAApB;AACH,OAdD;AAeH,KAhBD;AAiBA,WAAOF,oBAAP;AACH,GAhCD;;AAiCA,SAAOvJ,eAAP;AACH,CA1ZqB,EAAtB;;AA2ZAtB,OAAO,CAACC,OAAR,GAAkBqB,eAAlB;AACA0J,MAAM,CAAChL,OAAP,GAAiBA,OAAO,CAACC,OAAzB","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.resource_manager.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _object = require(\"../../core/utils/object\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _query = _interopRequireDefault(require(\"../../data/query\"));\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _utils = require(\"../../data/data_source/utils\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar getValueExpr = function(resource) {\r\n    return resource.valueExpr || \"id\"\r\n};\r\nvar getDisplayExpr = function(resource) {\r\n    return resource.displayExpr || \"text\"\r\n};\r\nvar ResourceManager = function() {\r\n    function ResourceManager(resources) {\r\n        this._resourceLoader = {};\r\n        this.setResources(resources)\r\n    }\r\n    var _proto = ResourceManager.prototype;\r\n    _proto._createWrappedDataSource = function(dataSource) {\r\n        if (dataSource instanceof _data_source.DataSource) {\r\n            return dataSource\r\n        }\r\n        var result = {\r\n            store: (0, _utils.normalizeDataSourceOptions)(dataSource).store,\r\n            pageSize: 0\r\n        };\r\n        if (!Array.isArray(dataSource)) {\r\n            result.filter = dataSource.filter\r\n        }\r\n        return new _data_source.DataSource(result)\r\n    };\r\n    _proto._mapResourceData = function(resource, data) {\r\n        var valueGetter = (0, _data.compileGetter)(getValueExpr(resource));\r\n        var displayGetter = (0, _data.compileGetter)(getDisplayExpr(resource));\r\n        return (0, _iterator.map)(data, function(item) {\r\n            var result = {\r\n                id: valueGetter(item),\r\n                text: displayGetter(item)\r\n            };\r\n            if (item.color) {\r\n                result.color = item.color\r\n            }\r\n            return result\r\n        })\r\n    };\r\n    _proto._isMultipleResource = function(resourceField) {\r\n        var result = false;\r\n        (0, _iterator.each)(this.getResources(), function(_, resource) {\r\n            var field = this.getField(resource);\r\n            if (field === resourceField) {\r\n                result = resource.allowMultiple;\r\n                return false\r\n            }\r\n        }.bind(this));\r\n        return result\r\n    };\r\n    _proto.getDataAccessors = function(field, type) {\r\n        var result = null;\r\n        (0, _iterator.each)(this._dataAccessors[type], function(accessorName, accessors) {\r\n            if (field === accessorName) {\r\n                result = accessors;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    };\r\n    _proto.getField = function(resource) {\r\n        return resource.fieldExpr || resource.field\r\n    };\r\n    _proto.setResources = function(resources) {\r\n        this._resources = resources;\r\n        this._dataAccessors = {\r\n            getter: {},\r\n            setter: {}\r\n        };\r\n        this._resourceFields = (0, _iterator.map)(resources || [], function(resource) {\r\n            var field = this.getField(resource);\r\n            this._dataAccessors.getter[field] = (0, _data.compileGetter)(field);\r\n            this._dataAccessors.setter[field] = (0, _data.compileSetter)(field);\r\n            return field\r\n        }.bind(this))\r\n    };\r\n    _proto.getResources = function() {\r\n        return this._resources || []\r\n    };\r\n    _proto.getResourcesData = function() {\r\n        return this._resourcesData || []\r\n    };\r\n    _proto.getEditors = function() {\r\n        var result = [];\r\n        var that = this;\r\n        (0, _iterator.each)(this.getResources(), function(i, resource) {\r\n            var field = that.getField(resource);\r\n            var currentResourceItems = that._getResourceDataByField(field);\r\n            result.push({\r\n                editorOptions: {\r\n                    dataSource: currentResourceItems.length ? currentResourceItems : that._createWrappedDataSource(resource.dataSource),\r\n                    displayExpr: getDisplayExpr(resource),\r\n                    valueExpr: getValueExpr(resource)\r\n                },\r\n                dataField: field,\r\n                editorType: resource.allowMultiple ? \"dxTagBox\" : \"dxSelectBox\",\r\n                label: {\r\n                    text: resource.label || field\r\n                }\r\n            })\r\n        });\r\n        return result\r\n    };\r\n    _proto.getResourceDataByValue = function(field, value) {\r\n        var that = this;\r\n        var result = new _deferred.Deferred;\r\n        (0, _iterator.each)(this.getResources(), function(_, resource) {\r\n            var resourceField = that.getField(resource);\r\n            if (resourceField === field) {\r\n                var dataSource = that._createWrappedDataSource(resource.dataSource);\r\n                var valueExpr = getValueExpr(resource);\r\n                if (!that._resourceLoader[field]) {\r\n                    that._resourceLoader[field] = dataSource.load()\r\n                }\r\n                that._resourceLoader[field].done(function(data) {\r\n                    var filteredData = (0, _query.default)(data).filter(valueExpr, value).toArray();\r\n                    delete that._resourceLoader[field];\r\n                    result.resolve(filteredData[0])\r\n                }).fail(function() {\r\n                    delete that._resourceLoader[field];\r\n                    result.reject()\r\n                });\r\n                return false\r\n            }\r\n        });\r\n        return result.promise()\r\n    };\r\n    _proto.setResourcesToItem = function(itemData, resources) {\r\n        var resourcesSetter = this._dataAccessors.setter;\r\n        for (var name in resources) {\r\n            if (Object.prototype.hasOwnProperty.call(resources, name)) {\r\n                var resourceData = resources[name];\r\n                resourcesSetter[name](itemData, this._isMultipleResource(name) ? (0, _array.wrapToArray)(resourceData) : resourceData)\r\n            }\r\n        }\r\n    };\r\n    _proto.getResourcesFromItem = function(itemData, wrapOnlyMultipleResources) {\r\n        var _this = this;\r\n        var result = null;\r\n        if (!(0, _type.isDefined)(wrapOnlyMultipleResources)) {\r\n            wrapOnlyMultipleResources = false\r\n        }\r\n        this._resourceFields.forEach(function(field) {\r\n            (0, _iterator.each)(itemData, function(fieldName, fieldValue) {\r\n                var tempObject = {};\r\n                tempObject[fieldName] = fieldValue;\r\n                var resourceData = _this.getDataAccessors(field, \"getter\")(tempObject);\r\n                if ((0, _type.isDefined)(resourceData)) {\r\n                    if (!result) {\r\n                        result = {}\r\n                    }\r\n                    if (1 === resourceData.length) {\r\n                        resourceData = resourceData[0]\r\n                    }\r\n                    if (!wrapOnlyMultipleResources || wrapOnlyMultipleResources && _this._isMultipleResource(field)) {\r\n                        _this.getDataAccessors(field, \"setter\")(tempObject, (0, _array.wrapToArray)(resourceData))\r\n                    } else {\r\n                        _this.getDataAccessors(field, \"setter\")(tempObject, resourceData)\r\n                    }(0, _extend.extend)(result, tempObject);\r\n                    return true\r\n                }\r\n            })\r\n        });\r\n        return result\r\n    };\r\n    _proto.loadResources = function(groups) {\r\n        var result = new _deferred.Deferred;\r\n        var that = this;\r\n        var deferreds = [];\r\n        (0, _iterator.each)(this.getResourcesByFields(groups), function(i, resource) {\r\n            var deferred = new _deferred.Deferred;\r\n            var field = that.getField(resource);\r\n            deferreds.push(deferred);\r\n            that._createWrappedDataSource(resource.dataSource).load().done(function(data) {\r\n                deferred.resolve({\r\n                    name: field,\r\n                    items: that._mapResourceData(resource, data),\r\n                    data: data\r\n                })\r\n            }).fail(function() {\r\n                deferred.reject()\r\n            })\r\n        });\r\n        if (!deferreds.length) {\r\n            that._resourcesData = [];\r\n            return result.resolve([])\r\n        }\r\n        _deferred.when.apply(null, deferreds).done(function() {\r\n            var data = Array.prototype.slice.call(arguments);\r\n            var mapFunction = function(obj) {\r\n                return {\r\n                    name: obj.name,\r\n                    items: obj.items,\r\n                    data: obj.data\r\n                }\r\n            };\r\n            that._resourcesData = data;\r\n            result.resolve(data.map(mapFunction))\r\n        }).fail(function() {\r\n            result.reject()\r\n        });\r\n        return result.promise()\r\n    };\r\n    _proto.getResourcesByFields = function(fields) {\r\n        return (0, _common.grep)(this.getResources(), function(resource) {\r\n            var field = this.getField(resource);\r\n            return (0, _array.inArray)(field, fields) > -1\r\n        }.bind(this))\r\n    };\r\n    _proto.getResourceByField = function(field) {\r\n        return this.getResourcesByFields([field])[0] || {}\r\n    };\r\n    _proto.getResourceColor = function(field, value) {\r\n        var valueExpr = this.getResourceByField(field).valueExpr || \"id\";\r\n        var valueGetter = (0, _data.compileGetter)(valueExpr);\r\n        var colorExpr = this.getResourceByField(field).colorExpr || \"color\";\r\n        var colorGetter = (0, _data.compileGetter)(colorExpr);\r\n        var result = new _deferred.Deferred;\r\n        var resourceData = this._getResourceDataByField(field);\r\n        var resourceDataLength = resourceData.length;\r\n        var color;\r\n        if (resourceDataLength) {\r\n            for (var i = 0; i < resourceDataLength; i++) {\r\n                if (valueGetter(resourceData[i]) === value) {\r\n                    color = colorGetter(resourceData[i]);\r\n                    break\r\n                }\r\n            }\r\n            result.resolve(color)\r\n        } else {\r\n            this.getResourceDataByValue(field, value).done(function(resourceData) {\r\n                if (resourceData) {\r\n                    color = colorGetter(resourceData)\r\n                }\r\n                result.resolve(color)\r\n            }).fail(function() {\r\n                result.reject()\r\n            })\r\n        }\r\n        return result.promise()\r\n    };\r\n    _proto.getResourceForPainting = function(groups) {\r\n        var resources = this.getResources();\r\n        var result;\r\n        (0, _iterator.each)(resources, function(index, resource) {\r\n            if (resource.useColorAsDefault) {\r\n                result = resource;\r\n                return false\r\n            }\r\n        });\r\n        if (!result) {\r\n            if (Array.isArray(groups) && groups.length) {\r\n                resources = this.getResourcesByFields(groups)\r\n            }\r\n            result = resources[resources.length - 1]\r\n        }\r\n        return result\r\n    };\r\n    _proto.createResourcesTree = function(groups) {\r\n        var leafIndex = 0;\r\n        var groupIndex = groupIndex || 0;\r\n\r\n        function make(group, groupIndex, result, parent) {\r\n            result = result || [];\r\n            for (var i = 0; i < group.items.length; i++) {\r\n                var currentGroupItem = group.items[i];\r\n                var resultItem = {\r\n                    name: group.name,\r\n                    value: currentGroupItem.id,\r\n                    title: currentGroupItem.text,\r\n                    data: group.data && group.data[i],\r\n                    children: [],\r\n                    parent: parent ? parent : null\r\n                };\r\n                result.push(resultItem);\r\n                var nextGroupIndex = groupIndex + 1;\r\n                if (groups[nextGroupIndex]) {\r\n                    make.call(this, groups[nextGroupIndex], nextGroupIndex, resultItem.children, resultItem)\r\n                }\r\n                if (!resultItem.children.length) {\r\n                    resultItem.leafIndex = leafIndex;\r\n                    leafIndex++\r\n                }\r\n            }\r\n            return result\r\n        }\r\n        return make.call(this, groups[0], 0)\r\n    };\r\n    _proto._hasGroupItem = function(appointmentResources, groupName, itemValue) {\r\n        var group = this.getDataAccessors(groupName, \"getter\")(appointmentResources);\r\n        if (group) {\r\n            if ((0, _array.inArray)(itemValue, group) > -1) {\r\n                return true\r\n            }\r\n        }\r\n        return false\r\n    };\r\n    _proto._getResourceDataByField = function(fieldName) {\r\n        var loadedResources = this.getResourcesData();\r\n        var currentResourceData = [];\r\n        for (var i = 0, resourceCount = loadedResources.length; i < resourceCount; i++) {\r\n            if (loadedResources[i].name === fieldName) {\r\n                currentResourceData = loadedResources[i].data;\r\n                break\r\n            }\r\n        }\r\n        return currentResourceData\r\n    };\r\n    _proto.getResourceTreeLeaves = function(tree, appointmentResources, result) {\r\n        result = result || [];\r\n        for (var i = 0; i < tree.length; i++) {\r\n            if (!this._hasGroupItem(appointmentResources, tree[i].name, tree[i].value)) {\r\n                continue\r\n            }\r\n            if ((0, _type.isDefined)(tree[i].leafIndex)) {\r\n                result.push(tree[i].leafIndex)\r\n            }\r\n            if (tree[i].children) {\r\n                this.getResourceTreeLeaves(tree[i].children, appointmentResources, result)\r\n            }\r\n        }\r\n        return result\r\n    };\r\n    _proto.groupAppointmentsByResources = function(appointments, resources) {\r\n        var tree = this.createResourcesTree(resources);\r\n        var result = {};\r\n        (0, _iterator.each)(appointments, function(_, appointment) {\r\n            var appointmentResources = this.getResourcesFromItem(appointment);\r\n            var treeLeaves = this.getResourceTreeLeaves(tree, appointmentResources);\r\n            for (var i = 0; i < treeLeaves.length; i++) {\r\n                if (!result[treeLeaves[i]]) {\r\n                    result[treeLeaves[i]] = []\r\n                }\r\n                result[treeLeaves[i]].push((0, _object.deepExtendArraySafe)({}, appointment, true))\r\n            }\r\n        }.bind(this));\r\n        return result\r\n    };\r\n    _proto.reduceResourcesTree = function(tree, existingAppointments, _result) {\r\n        _result = _result ? _result.children : [];\r\n        var that = this;\r\n        tree.forEach(function(node, index) {\r\n            var ok = false;\r\n            var resourceName = node.name;\r\n            var resourceValue = node.value;\r\n            var resourceTitle = node.title;\r\n            var resourceData = node.data;\r\n            var resourceGetter = that.getDataAccessors(resourceName, \"getter\");\r\n            existingAppointments.forEach(function(appointment) {\r\n                if (!ok) {\r\n                    var resourceFromAppointment = resourceGetter(appointment);\r\n                    if (Array.isArray(resourceFromAppointment)) {\r\n                        if (resourceFromAppointment.indexOf(resourceValue) > -1) {\r\n                            _result.push({\r\n                                name: resourceName,\r\n                                value: resourceValue,\r\n                                title: resourceTitle,\r\n                                data: resourceData,\r\n                                children: []\r\n                            });\r\n                            ok = true\r\n                        }\r\n                    } else {\r\n                        if (resourceFromAppointment === resourceValue) {\r\n                            _result.push({\r\n                                name: resourceName,\r\n                                value: resourceValue,\r\n                                title: resourceTitle,\r\n                                data: resourceData,\r\n                                children: []\r\n                            });\r\n                            ok = true\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            if (ok && node.children && node.children.length) {\r\n                that.reduceResourcesTree(node.children, existingAppointments, _result[index])\r\n            }\r\n        });\r\n        return _result\r\n    };\r\n    _proto.getResourcesDataByGroups = function(groups) {\r\n        var _this2 = this;\r\n        var resourcesData = this.getResourcesData();\r\n        if (!groups) {\r\n            return resourcesData\r\n        }\r\n        var fieldNames = Object.getOwnPropertyNames(groups);\r\n        var resourceData = resourcesData.filter(function(item) {\r\n            return fieldNames.indexOf(item.name) !== -1\r\n        });\r\n        var currentResourcesData = [];\r\n        resourceData.forEach(function(data) {\r\n            return currentResourcesData.push((0, _extend.extend)({}, data))\r\n        });\r\n        (0, _iterator.each)(groups, function(_, value) {\r\n            currentResourcesData.forEach(function(resourceData) {\r\n                var items = resourceData.items,\r\n                    data = resourceData.data,\r\n                    name = resourceData.name;\r\n                var resource = _this2.getResourceByField(name);\r\n                var valueExpr = getValueExpr(resource);\r\n                var currentItems = items.filter(function(item) {\r\n                    return item.id === value\r\n                });\r\n                var currentData = data.filter(function(item) {\r\n                    return item[valueExpr] === value\r\n                });\r\n                resourceData.items = currentItems;\r\n                resourceData.data = currentData\r\n            })\r\n        });\r\n        return currentResourcesData\r\n    };\r\n    return ResourceManager\r\n}();\r\nexports.default = ResourceManager;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}