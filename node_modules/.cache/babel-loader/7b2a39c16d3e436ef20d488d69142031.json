{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/compactAppointmentsHelper.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.CompactAppointmentsHelper = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _button = _interopRequireDefault(require(\"../button\"));\n\nvar _translator = require(\"../../animation/translator\");\n\nvar _message = _interopRequireDefault(require(\"../../localization/message\"));\n\nvar _function_template = require(\"../../core/templates/function_template\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _position = require(\"../../core/utils/position\");\n\nvar _dataStructures = require(\"./dataStructures\");\n\nvar _constants = require(\"./constants\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar APPOINTMENT_COLLECTOR_CLASS = \"dx-scheduler-appointment-collector\";\nvar COMPACT_APPOINTMENT_COLLECTOR_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-compact\";\nvar APPOINTMENT_COLLECTOR_CONTENT_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-content\";\nvar WEEK_VIEW_COLLECTOR_OFFSET = 5;\nvar COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET = 1;\n\nvar CompactAppointmentsHelper = function () {\n  function CompactAppointmentsHelper(instance) {\n    this.instance = instance;\n    this.elements = [];\n  }\n\n  var _proto = CompactAppointmentsHelper.prototype;\n\n  _proto.render = function (options) {\n    var isCompact = options.isCompact,\n        items = options.items,\n        buttonColor = options.buttonColor;\n\n    var template = this._createTemplate(items.data.length, isCompact);\n\n    var button = this._createCompactButton(template, options);\n\n    var $button = button.$element();\n\n    this._makeBackgroundColor($button, items.colors, buttonColor);\n\n    this._makeBackgroundDarker($button);\n\n    this.elements.push($button);\n    $button.data(\"items\", this._createTooltipInfos(items));\n    return $button;\n  };\n\n  _proto.clear = function () {\n    this.elements.forEach(function (button) {\n      button.detach();\n      button.remove();\n    });\n    this.elements = [];\n  };\n\n  _proto._createTooltipInfos = function (items) {\n    var _this = this;\n\n    return items.data.map(function (appointment, index) {\n      var _items$settings;\n\n      var targetedAdapter = _this.instance.createAppointmentAdapter(appointment).clone();\n\n      if ((null === (_items$settings = items.settings) || void 0 === _items$settings ? void 0 : _items$settings.length) > 0) {\n        var info = items.settings[index].info;\n        targetedAdapter.startDate = info.sourceAppointment.startDate;\n        targetedAdapter.endDate = info.sourceAppointment.endDate;\n      }\n\n      return new _dataStructures.AppointmentTooltipInfo(appointment, targetedAdapter.source(), items.colors[index], items.settings[index]);\n    });\n  };\n\n  _proto._onButtonClick = function (e, options) {\n    var $button = (0, _renderer.default)(e.element);\n    this.instance.showAppointmentTooltipCore($button, $button.data(\"items\"), this._getExtraOptionsForTooltip(options));\n  };\n\n  _proto._getExtraOptionsForTooltip = function (options) {\n    return {\n      clickEvent: this._clickEvent(options.onAppointmentClick).bind(this),\n      dragBehavior: options.allowDrag && this._createTooltipDragBehavior().bind(this),\n      dropDownAppointmentTemplate: this.instance.option().dropDownAppointmentTemplate,\n      isButtonClick: true\n    };\n  };\n\n  _proto._clickEvent = function (onAppointmentClick) {\n    var _this2 = this;\n\n    return function (e) {\n      var config = {\n        itemData: e.itemData.appointment,\n        itemElement: e.itemElement\n      };\n      var createClickEvent = (0, _extend.extendFromObject)(_this2.instance.fire(\"mapAppointmentFields\", config), e, false);\n      delete createClickEvent.itemData;\n      delete createClickEvent.itemIndex;\n      delete createClickEvent.itemElement;\n      onAppointmentClick(createClickEvent);\n    };\n  };\n\n  _proto._createTooltipDragBehavior = function () {\n    var _this3 = this;\n\n    return function (e) {\n      var $element = (0, _renderer.default)(e.element);\n\n      var workSpace = _this3.instance.getWorkSpace();\n\n      var getItemData = function (itemElement) {\n        var _$$data;\n\n        return null === (_$$data = (0, _renderer.default)(itemElement).data(_constants.LIST_ITEM_DATA_KEY)) || void 0 === _$$data ? void 0 : _$$data.appointment;\n      };\n\n      var getItemSettings = function (_, event) {\n        return event.itemSettings;\n      };\n\n      var options = {\n        filter: \".\".concat(_constants.LIST_ITEM_CLASS),\n        isSetCursorOffset: true\n      };\n\n      workSpace._createDragBehaviorBase($element, getItemData, getItemSettings, options);\n    };\n  };\n\n  _proto._getCollectorOffset = function (width, cellWidth) {\n    return cellWidth - width - this._getCollectorRightOffset();\n  };\n\n  _proto._getCollectorRightOffset = function () {\n    return this.instance.getRenderingStrategyInstance()._isCompactTheme() ? COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET : WEEK_VIEW_COLLECTOR_OFFSET;\n  };\n\n  _proto._makeBackgroundDarker = function (button) {\n    button.css(\"boxShadow\", \"inset \".concat((0, _position.getBoundingRect)(button.get(0)).width, \"px 0 0 0 rgba(0, 0, 0, 0.3)\"));\n  };\n\n  _proto._makeBackgroundColor = function ($button, colors, color) {\n    _deferred.when.apply(null, colors).done(function () {\n      this._makeBackgroundColorCore($button, color, arguments);\n    }.bind(this));\n  };\n\n  _proto._makeBackgroundColorCore = function ($button, color, itemsColors) {\n    var paintButton = true;\n    var currentItemColor;\n    color && color.done(function (color) {\n      if (itemsColors.length) {\n        currentItemColor = itemsColors[0];\n\n        for (var i = 1; i < itemsColors.length; i++) {\n          if (currentItemColor !== itemsColors[i]) {\n            paintButton = false;\n            break;\n          }\n\n          currentItemColor = color;\n        }\n      }\n\n      color && paintButton && $button.css(\"backgroundColor\", color);\n    }.bind(this));\n  };\n\n  _proto._setPosition = function (element, position) {\n    (0, _translator.move)(element, {\n      top: position.top,\n      left: position.left\n    });\n  };\n\n  _proto._createCompactButton = function (template, options) {\n    var _this4 = this;\n\n    var $button = this._createCompactButtonElement(options);\n\n    return this.instance._createComponent($button, _button.default, {\n      type: \"default\",\n      width: options.width,\n      height: options.height,\n      onClick: function (e) {\n        return _this4._onButtonClick(e, options);\n      },\n      template: this._renderTemplate(template, options.items, options.isCompact)\n    });\n  };\n\n  _proto._createCompactButtonElement = function (_ref) {\n    var isCompact = _ref.isCompact,\n        $container = _ref.$container,\n        width = _ref.width,\n        coordinates = _ref.coordinates,\n        applyOffset = _ref.applyOffset,\n        cellWidth = _ref.cellWidth;\n    var result = (0, _renderer.default)(\"<div>\").addClass(APPOINTMENT_COLLECTOR_CLASS).toggleClass(COMPACT_APPOINTMENT_COLLECTOR_CLASS, isCompact).appendTo($container);\n    var offset = applyOffset ? this._getCollectorOffset(width, cellWidth) : 0;\n\n    this._setPosition(result, {\n      top: coordinates.top,\n      left: coordinates.left + offset\n    });\n\n    return result;\n  };\n\n  _proto._renderTemplate = function (template, items, isCompact) {\n    return new _function_template.FunctionTemplate(function (options) {\n      return template.render({\n        model: {\n          appointmentCount: items.data.length,\n          isCompact: isCompact\n        },\n        container: options.container\n      });\n    });\n  };\n\n  _proto._createTemplate = function (count, isCompact) {\n    this._initButtonTemplate(count, isCompact);\n\n    return this.instance._getAppointmentTemplate(\"appointmentCollectorTemplate\");\n  };\n\n  _proto._initButtonTemplate = function (count, isCompact) {\n    var _this5 = this;\n\n    this.instance._templateManager.addDefaultTemplates({\n      appointmentCollector: new _function_template.FunctionTemplate(function (options) {\n        return _this5._createButtonTemplate(count, (0, _renderer.default)(options.container), isCompact);\n      })\n    });\n  };\n\n  _proto._createButtonTemplate = function (appointmentCount, element, isCompact) {\n    var text = isCompact ? appointmentCount : _message.default.getFormatter(\"dxScheduler-moreAppointments\")(appointmentCount);\n    return element.append((0, _renderer.default)(\"<span>\").text(text)).addClass(APPOINTMENT_COLLECTOR_CONTENT_CLASS);\n  };\n\n  return CompactAppointmentsHelper;\n}();\n\nexports.CompactAppointmentsHelper = CompactAppointmentsHelper;","map":{"version":3,"sources":["/home/emma/node_modules/devextreme/ui/scheduler/compactAppointmentsHelper.js"],"names":["exports","CompactAppointmentsHelper","_renderer","_interopRequireDefault","require","_button","_translator","_message","_function_template","_deferred","_extend","_position","_dataStructures","_constants","obj","__esModule","APPOINTMENT_COLLECTOR_CLASS","COMPACT_APPOINTMENT_COLLECTOR_CLASS","APPOINTMENT_COLLECTOR_CONTENT_CLASS","WEEK_VIEW_COLLECTOR_OFFSET","COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET","instance","elements","_proto","prototype","render","options","isCompact","items","buttonColor","template","_createTemplate","data","length","button","_createCompactButton","$button","$element","_makeBackgroundColor","colors","_makeBackgroundDarker","push","_createTooltipInfos","clear","forEach","detach","remove","_this","map","appointment","index","_items$settings","targetedAdapter","createAppointmentAdapter","clone","settings","info","startDate","sourceAppointment","endDate","AppointmentTooltipInfo","source","_onButtonClick","e","default","element","showAppointmentTooltipCore","_getExtraOptionsForTooltip","clickEvent","_clickEvent","onAppointmentClick","bind","dragBehavior","allowDrag","_createTooltipDragBehavior","dropDownAppointmentTemplate","option","isButtonClick","_this2","config","itemData","itemElement","createClickEvent","extendFromObject","fire","itemIndex","_this3","workSpace","getWorkSpace","getItemData","_$$data","LIST_ITEM_DATA_KEY","getItemSettings","_","event","itemSettings","filter","concat","LIST_ITEM_CLASS","isSetCursorOffset","_createDragBehaviorBase","_getCollectorOffset","width","cellWidth","_getCollectorRightOffset","getRenderingStrategyInstance","_isCompactTheme","css","getBoundingRect","get","color","when","apply","done","_makeBackgroundColorCore","arguments","itemsColors","paintButton","currentItemColor","i","_setPosition","position","move","top","left","_this4","_createCompactButtonElement","_createComponent","type","height","onClick","_renderTemplate","_ref","$container","coordinates","applyOffset","result","addClass","toggleClass","appendTo","offset","FunctionTemplate","model","appointmentCount","container","count","_initButtonTemplate","_getAppointmentTemplate","_this5","_templateManager","addDefaultTemplates","appointmentCollector","_createButtonTemplate","text","getFormatter","append"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/compactAppointmentsHelper.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.CompactAppointmentsHelper = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _button = _interopRequireDefault(require(\"../button\"));\r\nvar _translator = require(\"../../animation/translator\");\r\nvar _message = _interopRequireDefault(require(\"../../localization/message\"));\r\nvar _function_template = require(\"../../core/templates/function_template\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _position = require(\"../../core/utils/position\");\r\nvar _dataStructures = require(\"./dataStructures\");\r\nvar _constants = require(\"./constants\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar APPOINTMENT_COLLECTOR_CLASS = \"dx-scheduler-appointment-collector\";\r\nvar COMPACT_APPOINTMENT_COLLECTOR_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-compact\";\r\nvar APPOINTMENT_COLLECTOR_CONTENT_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-content\";\r\nvar WEEK_VIEW_COLLECTOR_OFFSET = 5;\r\nvar COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET = 1;\r\nvar CompactAppointmentsHelper = function() {\r\n    function CompactAppointmentsHelper(instance) {\r\n        this.instance = instance;\r\n        this.elements = []\r\n    }\r\n    var _proto = CompactAppointmentsHelper.prototype;\r\n    _proto.render = function(options) {\r\n        var isCompact = options.isCompact,\r\n            items = options.items,\r\n            buttonColor = options.buttonColor;\r\n        var template = this._createTemplate(items.data.length, isCompact);\r\n        var button = this._createCompactButton(template, options);\r\n        var $button = button.$element();\r\n        this._makeBackgroundColor($button, items.colors, buttonColor);\r\n        this._makeBackgroundDarker($button);\r\n        this.elements.push($button);\r\n        $button.data(\"items\", this._createTooltipInfos(items));\r\n        return $button\r\n    };\r\n    _proto.clear = function() {\r\n        this.elements.forEach(function(button) {\r\n            button.detach();\r\n            button.remove()\r\n        });\r\n        this.elements = []\r\n    };\r\n    _proto._createTooltipInfos = function(items) {\r\n        var _this = this;\r\n        return items.data.map(function(appointment, index) {\r\n            var _items$settings;\r\n            var targetedAdapter = _this.instance.createAppointmentAdapter(appointment).clone();\r\n            if ((null === (_items$settings = items.settings) || void 0 === _items$settings ? void 0 : _items$settings.length) > 0) {\r\n                var info = items.settings[index].info;\r\n                targetedAdapter.startDate = info.sourceAppointment.startDate;\r\n                targetedAdapter.endDate = info.sourceAppointment.endDate\r\n            }\r\n            return new _dataStructures.AppointmentTooltipInfo(appointment, targetedAdapter.source(), items.colors[index], items.settings[index])\r\n        })\r\n    };\r\n    _proto._onButtonClick = function(e, options) {\r\n        var $button = (0, _renderer.default)(e.element);\r\n        this.instance.showAppointmentTooltipCore($button, $button.data(\"items\"), this._getExtraOptionsForTooltip(options))\r\n    };\r\n    _proto._getExtraOptionsForTooltip = function(options) {\r\n        return {\r\n            clickEvent: this._clickEvent(options.onAppointmentClick).bind(this),\r\n            dragBehavior: options.allowDrag && this._createTooltipDragBehavior().bind(this),\r\n            dropDownAppointmentTemplate: this.instance.option().dropDownAppointmentTemplate,\r\n            isButtonClick: true\r\n        }\r\n    };\r\n    _proto._clickEvent = function(onAppointmentClick) {\r\n        var _this2 = this;\r\n        return function(e) {\r\n            var config = {\r\n                itemData: e.itemData.appointment,\r\n                itemElement: e.itemElement\r\n            };\r\n            var createClickEvent = (0, _extend.extendFromObject)(_this2.instance.fire(\"mapAppointmentFields\", config), e, false);\r\n            delete createClickEvent.itemData;\r\n            delete createClickEvent.itemIndex;\r\n            delete createClickEvent.itemElement;\r\n            onAppointmentClick(createClickEvent)\r\n        }\r\n    };\r\n    _proto._createTooltipDragBehavior = function() {\r\n        var _this3 = this;\r\n        return function(e) {\r\n            var $element = (0, _renderer.default)(e.element);\r\n            var workSpace = _this3.instance.getWorkSpace();\r\n            var getItemData = function(itemElement) {\r\n                var _$$data;\r\n                return null === (_$$data = (0, _renderer.default)(itemElement).data(_constants.LIST_ITEM_DATA_KEY)) || void 0 === _$$data ? void 0 : _$$data.appointment\r\n            };\r\n            var getItemSettings = function(_, event) {\r\n                return event.itemSettings\r\n            };\r\n            var options = {\r\n                filter: \".\".concat(_constants.LIST_ITEM_CLASS),\r\n                isSetCursorOffset: true\r\n            };\r\n            workSpace._createDragBehaviorBase($element, getItemData, getItemSettings, options)\r\n        }\r\n    };\r\n    _proto._getCollectorOffset = function(width, cellWidth) {\r\n        return cellWidth - width - this._getCollectorRightOffset()\r\n    };\r\n    _proto._getCollectorRightOffset = function() {\r\n        return this.instance.getRenderingStrategyInstance()._isCompactTheme() ? COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET : WEEK_VIEW_COLLECTOR_OFFSET\r\n    };\r\n    _proto._makeBackgroundDarker = function(button) {\r\n        button.css(\"boxShadow\", \"inset \".concat((0, _position.getBoundingRect)(button.get(0)).width, \"px 0 0 0 rgba(0, 0, 0, 0.3)\"))\r\n    };\r\n    _proto._makeBackgroundColor = function($button, colors, color) {\r\n        _deferred.when.apply(null, colors).done(function() {\r\n            this._makeBackgroundColorCore($button, color, arguments)\r\n        }.bind(this))\r\n    };\r\n    _proto._makeBackgroundColorCore = function($button, color, itemsColors) {\r\n        var paintButton = true;\r\n        var currentItemColor;\r\n        color && color.done(function(color) {\r\n            if (itemsColors.length) {\r\n                currentItemColor = itemsColors[0];\r\n                for (var i = 1; i < itemsColors.length; i++) {\r\n                    if (currentItemColor !== itemsColors[i]) {\r\n                        paintButton = false;\r\n                        break\r\n                    }\r\n                    currentItemColor = color\r\n                }\r\n            }\r\n            color && paintButton && $button.css(\"backgroundColor\", color)\r\n        }.bind(this))\r\n    };\r\n    _proto._setPosition = function(element, position) {\r\n        (0, _translator.move)(element, {\r\n            top: position.top,\r\n            left: position.left\r\n        })\r\n    };\r\n    _proto._createCompactButton = function(template, options) {\r\n        var _this4 = this;\r\n        var $button = this._createCompactButtonElement(options);\r\n        return this.instance._createComponent($button, _button.default, {\r\n            type: \"default\",\r\n            width: options.width,\r\n            height: options.height,\r\n            onClick: function(e) {\r\n                return _this4._onButtonClick(e, options)\r\n            },\r\n            template: this._renderTemplate(template, options.items, options.isCompact)\r\n        })\r\n    };\r\n    _proto._createCompactButtonElement = function(_ref) {\r\n        var isCompact = _ref.isCompact,\r\n            $container = _ref.$container,\r\n            width = _ref.width,\r\n            coordinates = _ref.coordinates,\r\n            applyOffset = _ref.applyOffset,\r\n            cellWidth = _ref.cellWidth;\r\n        var result = (0, _renderer.default)(\"<div>\").addClass(APPOINTMENT_COLLECTOR_CLASS).toggleClass(COMPACT_APPOINTMENT_COLLECTOR_CLASS, isCompact).appendTo($container);\r\n        var offset = applyOffset ? this._getCollectorOffset(width, cellWidth) : 0;\r\n        this._setPosition(result, {\r\n            top: coordinates.top,\r\n            left: coordinates.left + offset\r\n        });\r\n        return result\r\n    };\r\n    _proto._renderTemplate = function(template, items, isCompact) {\r\n        return new _function_template.FunctionTemplate(function(options) {\r\n            return template.render({\r\n                model: {\r\n                    appointmentCount: items.data.length,\r\n                    isCompact: isCompact\r\n                },\r\n                container: options.container\r\n            })\r\n        })\r\n    };\r\n    _proto._createTemplate = function(count, isCompact) {\r\n        this._initButtonTemplate(count, isCompact);\r\n        return this.instance._getAppointmentTemplate(\"appointmentCollectorTemplate\")\r\n    };\r\n    _proto._initButtonTemplate = function(count, isCompact) {\r\n        var _this5 = this;\r\n        this.instance._templateManager.addDefaultTemplates({\r\n            appointmentCollector: new _function_template.FunctionTemplate(function(options) {\r\n                return _this5._createButtonTemplate(count, (0, _renderer.default)(options.container), isCompact)\r\n            })\r\n        })\r\n    };\r\n    _proto._createButtonTemplate = function(appointmentCount, element, isCompact) {\r\n        var text = isCompact ? appointmentCount : _message.default.getFormatter(\"dxScheduler-moreAppointments\")(appointmentCount);\r\n        return element.append((0, _renderer.default)(\"<span>\").text(text)).addClass(APPOINTMENT_COLLECTOR_CONTENT_CLASS)\r\n    };\r\n    return CompactAppointmentsHelper\r\n}();\r\nexports.CompactAppointmentsHelper = CompactAppointmentsHelper;\r\n"]},"metadata":{},"sourceType":"script"}